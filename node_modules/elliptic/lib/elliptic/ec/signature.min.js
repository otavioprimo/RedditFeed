"use strict";function Signature(e,t){return e instanceof Signature?e:void(this._importDER(e,t)||(assert(e.r&&e.s,"Signature without r or s"),this.r=new BN(e.r,16),this.s=new BN(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam))}function Position(){this.place=0}function getLength(e,t){var r=e[t.place++];if(!(128&r))return r;for(var n=15&r,i=0,a=0,o=t.place;n>a;a++,o++)i<<=8,i|=e[o];return t.place=o,i}function rmPadding(e){for(var t=0,r=e.length-1;!e[t]&&!(128&e[t+1])&&r>t;)t++;return 0===t?e:e.slice(t)}function constructLength(e,t){if(128>t)return void e.push(t);var r=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|r);--r;)e.push(t>>>(r<<3)&255);e.push(t)}var BN=require("bn.js"),elliptic=require("../../elliptic"),utils=elliptic.utils,assert=utils.assert;module.exports=Signature,Signature.prototype._importDER=function(e,t){e=utils.toArray(e,t);var r=new Position;if(48!==e[r.place++])return!1;var n=getLength(e,r);if(n+r.place!==e.length)return!1;if(2!==e[r.place++])return!1;var i=getLength(e,r),a=e.slice(r.place,i+r.place);if(r.place+=i,2!==e[r.place++])return!1;var o=getLength(e,r);if(e.length!==o+r.place)return!1;var s=e.slice(r.place,o+r.place);return 0===a[0]&&128&a[1]&&(a=a.slice(1)),0===s[0]&&128&s[1]&&(s=s.slice(1)),this.r=new BN(a),this.s=new BN(s),this.recoveryParam=null,!0},Signature.prototype.toDER=function(e){var t=this.r.toArray(),r=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&r[0]&&(r=[0].concat(r)),t=rmPadding(t),r=rmPadding(r);!(r[0]||128&r[1]);)r=r.slice(1);var n=[2];constructLength(n,t.length),n=n.concat(t),n.push(2),constructLength(n,r.length);var i=n.concat(r),a=[48];return constructLength(a,i.length),a=a.concat(i),utils.encode(a,e)};