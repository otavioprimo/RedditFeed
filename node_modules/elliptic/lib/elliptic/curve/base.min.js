"use strict";function BaseCurve(e,t){this.type=e,this.p=new BN(t.p,16),this.red=t.prime?BN.red(t.prime):BN.mont(this.p),this.zero=new BN(0).toRed(this.red),this.one=new BN(1).toRed(this.red),this.two=new BN(2).toRed(this.red),this.n=t.n&&new BN(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4);var r=this.n&&this.p.div(this.n);!r||r.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function BasePoint(e,t){this.curve=e,this.type=t,this.precomputed=null}var BN=require("bn.js"),elliptic=require("../../elliptic"),utils=elliptic.utils,getNAF=utils.getNAF,getJSF=utils.getJSF,assert=utils.assert;module.exports=BaseCurve,BaseCurve.prototype.point=function(){throw new Error("Not implemented")},BaseCurve.prototype.validate=function(){throw new Error("Not implemented")},BaseCurve.prototype._fixedNafMul=function(e,t){assert(e.precomputed);var r=e._getDoubles(),n=getNAF(t,1),i=(1<<r.step+1)-(r.step%2===0?2:1);i/=3;for(var a=[],o=0;o<n.length;o+=r.step){for(var s=0,t=o+r.step-1;t>=o;t--)s=(s<<1)+n[t];a.push(s)}for(var u=this.jpoint(null,null,null),l=this.jpoint(null,null,null),c=i;c>0;c--){for(var o=0;o<a.length;o++){var s=a[o];s===c?l=l.mixedAdd(r.points[o]):s===-c&&(l=l.mixedAdd(r.points[o].neg()))}u=u.add(l)}return u.toP()},BaseCurve.prototype._wnafMul=function(e,t){var r=4,n=e._getNAFPoints(r);r=n.wnd;for(var i=n.points,a=getNAF(t,r),o=this.jpoint(null,null,null),s=a.length-1;s>=0;s--){for(var t=0;s>=0&&0===a[s];s--)t++;if(s>=0&&t++,o=o.dblp(t),0>s)break;var u=a[s];assert(0!==u),o="affine"===e.type?u>0?o.mixedAdd(i[u-1>>1]):o.mixedAdd(i[-u-1>>1].neg()):u>0?o.add(i[u-1>>1]):o.add(i[-u-1>>1].neg())}return"affine"===e.type?o.toP():o},BaseCurve.prototype._wnafMulAdd=function(e,t,r,n,i){for(var a=this._wnafT1,o=this._wnafT2,s=this._wnafT3,u=0,l=0;n>l;l++){var c=t[l],f=c._getNAFPoints(e);a[l]=f.wnd,o[l]=f.points}for(var l=n-1;l>=1;l-=2){var p=l-1,h=l;if(1===a[p]&&1===a[h]){var d=[t[p],null,null,t[h]];0===t[p].y.cmp(t[h].y)?(d[1]=t[p].add(t[h]),d[2]=t[p].toJ().mixedAdd(t[h].neg())):0===t[p].y.cmp(t[h].y.redNeg())?(d[1]=t[p].toJ().mixedAdd(t[h]),d[2]=t[p].add(t[h].neg())):(d[1]=t[p].toJ().mixedAdd(t[h]),d[2]=t[p].toJ().mixedAdd(t[h].neg()));var v=[-3,-1,-5,-7,0,7,5,1,3],m=getJSF(r[p],r[h]);u=Math.max(m[0].length,u),s[p]=new Array(u),s[h]=new Array(u);for(var g=0;u>g;g++){var y=0|m[0][g],b=0|m[1][g];s[p][g]=v[3*(y+1)+(b+1)],s[h][g]=0,o[p]=d}}else s[p]=getNAF(r[p],a[p]),s[h]=getNAF(r[h],a[h]),u=Math.max(s[p].length,u),u=Math.max(s[h].length,u)}for(var _=this.jpoint(null,null,null),w=this._wnafT4,l=u;l>=0;l--){for(var x=0;l>=0;){for(var E=!0,g=0;n>g;g++)w[g]=0|s[g][l],0!==w[g]&&(E=!1);if(!E)break;x++,l--}if(l>=0&&x++,_=_.dblp(x),0>l)break;for(var g=0;n>g;g++){var c,S=w[g];0!==S&&(S>0?c=o[g][S-1>>1]:0>S&&(c=o[g][-S-1>>1].neg()),_="affine"===c.type?_.mixedAdd(c):_.add(c))}}for(var l=0;n>l;l++)o[l]=null;return i?_:_.toP()},BaseCurve.BasePoint=BasePoint,BasePoint.prototype.eq=function(){throw new Error("Not implemented")},BasePoint.prototype.validate=function(){return this.curve.validate(this)},BaseCurve.prototype.decodePoint=function(e,t){e=utils.toArray(e,t);var r=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1===2*r){6===e[0]?assert(e[e.length-1]%2===0):7===e[0]&&assert(e[e.length-1]%2===1);var n=this.point(e.slice(1,1+r),e.slice(1+r,1+2*r));return n}if((2===e[0]||3===e[0])&&e.length-1===r)return this.pointFromX(e.slice(1,1+r),3===e[0]);throw new Error("Unknown point format")},BasePoint.prototype.encodeCompressed=function(e){return this.encode(e,!0)},BasePoint.prototype._encode=function(e){var t=this.curve.p.byteLength(),r=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(r):[4].concat(r,this.getY().toArray("be",t))},BasePoint.prototype.encode=function(e,t){return utils.encode(this._encode(t),e)},BasePoint.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},BasePoint.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return t?t.points.length>=Math.ceil((e.bitLength()+1)/t.step):!1},BasePoint.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var r=[this],n=this,i=0;t>i;i+=e){for(var a=0;e>a;a++)n=n.dbl();r.push(n)}return{step:e,points:r}},BasePoint.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],r=(1<<e)-1,n=1===r?null:this.dbl(),i=1;r>i;i++)t[i]=t[i-1].add(n);return{wnd:e,points:t}},BasePoint.prototype._getBeta=function(){return null},BasePoint.prototype.dblp=function(e){for(var t=this,r=0;e>r;r++)t=t.dbl();return t};