function GHASH(t){this.h=t,this.state=new Buffer(16),this.state.fill(0),this.cache=new Buffer("")}function toArray(t){return[t.readUInt32BE(0),t.readUInt32BE(4),t.readUInt32BE(8),t.readUInt32BE(12)]}function fromArray(t){t=t.map(fixup_uint32);var e=new Buffer(16);return e.writeUInt32BE(t[0],0),e.writeUInt32BE(t[1],4),e.writeUInt32BE(t[2],8),e.writeUInt32BE(t[3],12),e}function fixup_uint32(t){var e,n;return e=t>uint_max||0>t?(n=Math.abs(t)%uint_max,0>t?uint_max-n:n):t}function xor(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}var zeros=new Buffer(16);zeros.fill(0),module.exports=GHASH,GHASH.prototype.ghash=function(t){for(var e=-1;++e<t.length;)this.state[e]^=t[e];this._multiply()},GHASH.prototype._multiply=function(){for(var n,r,i,t=toArray(this.h),e=[0,0,0,0],o=-1;++o<128;){for(r=0!==(this.state[~~(o/8)]&1<<7-o%8),r&&(e=xor(e,t)),i=0!==(1&t[3]),n=3;n>0;n--)t[n]=t[n]>>>1|(1&t[n-1])<<31;t[0]=t[0]>>>1,i&&(t[0]=t[0]^225<<24)}this.state=fromArray(e)},GHASH.prototype.update=function(t){this.cache=Buffer.concat([this.cache,t]);for(var e;this.cache.length>=16;)e=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(e)},GHASH.prototype["final"]=function(t,e){return this.cache.length&&this.ghash(Buffer.concat([this.cache,zeros],16)),this.ghash(fromArray([0,t,0,e])),this.state};var uint_max=Math.pow(2,32);