function Decipher(t,e,n){return this instanceof Decipher?(Transform.call(this),this._cache=new Splitter,this._last=void 0,this._cipher=new aes.AES(e),this._prev=new Buffer(n.length),n.copy(this._prev),this._mode=t,void(this._autopadding=!0)):new Decipher(t,e,n)}function Splitter(){return this instanceof Splitter?void(this.cache=new Buffer("")):new Splitter}function unpad(t){for(var e=t[15],n=-1;++n<e;)if(t[n+(16-e)]!==e)throw new Error("unable to decrypt data");return 16!==e?t.slice(0,16-e):void 0}function createDecipheriv(t,e,n){var r=modes[t.toLowerCase()];if(!r)throw new TypeError("invalid suite type");if("string"==typeof n&&(n=new Buffer(n)),"string"==typeof e&&(e=new Buffer(e)),e.length!==r.key/8)throw new TypeError("invalid key length "+e.length);if(n.length!==r.iv)throw new TypeError("invalid iv length "+n.length);return"stream"===r.type?new StreamCipher(modelist[r.mode],e,n,!0):"auth"===r.type?new AuthCipher(modelist[r.mode],e,n,!0):new Decipher(modelist[r.mode],e,n)}function createDecipher(t,e){var n=modes[t.toLowerCase()];if(!n)throw new TypeError("invalid suite type");var r=ebtk(e,!1,n.key,n.iv);return createDecipheriv(t,r.key,r.iv)}var aes=require("./aes"),Transform=require("cipher-base"),inherits=require("inherits"),modes=require("./modes"),StreamCipher=require("./streamCipher"),AuthCipher=require("./authCipher"),ebtk=require("evp_bytestokey");inherits(Decipher,Transform),Decipher.prototype._update=function(t){this._cache.add(t);for(var e,n,r=[];e=this._cache.get(this._autopadding);)n=this._mode.decrypt(this,e),r.push(n);return Buffer.concat(r)},Decipher.prototype._final=function(){var t=this._cache.flush();if(this._autopadding)return unpad(this._mode.decrypt(this,t));if(t)throw new Error("data not multiple of block length")},Decipher.prototype.setAutoPadding=function(t){return this._autopadding=!!t,this},Splitter.prototype.add=function(t){this.cache=Buffer.concat([this.cache,t])},Splitter.prototype.get=function(t){var e;if(t){if(this.cache.length>16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e}else if(this.cache.length>=16)return e=this.cache.slice(0,16),this.cache=this.cache.slice(16),e;return null},Splitter.prototype.flush=function(){return this.cache.length?this.cache:void 0};var modelist={ECB:require("./modes/ecb"),CBC:require("./modes/cbc"),CFB:require("./modes/cfb"),CFB8:require("./modes/cfb8"),CFB1:require("./modes/cfb1"),OFB:require("./modes/ofb"),CTR:require("./modes/ctr"),GCM:require("./modes/ctr")};exports.createDecipher=createDecipher,exports.createDecipheriv=createDecipheriv;