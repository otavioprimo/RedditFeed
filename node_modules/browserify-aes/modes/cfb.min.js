function encryptStart(e,t,r){var n=t.length,i=xor(t,e._cache);return e._cache=e._cache.slice(n),e._prev=Buffer.concat([e._prev,r?t:i]),i}var xor=require("buffer-xor");exports.encrypt=function(e,t,r){for(var i,n=new Buffer("");t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=new Buffer("")),!(e._cache.length<=t.length)){n=Buffer.concat([n,encryptStart(e,t,r)]);break}i=e._cache.length,n=Buffer.concat([n,encryptStart(e,t.slice(0,i),r)]),t=t.slice(i)}return n};