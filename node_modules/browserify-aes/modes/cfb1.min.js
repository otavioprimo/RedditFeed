function encryptByte(e,t,r){for(var n,s,u,i=-1,o=8,a=0;++i<o;)n=e._cipher.encryptBlock(e._prev),s=t&1<<7-i?128:0,u=n[0]^s,a+=(128&u)>>i%8,e._prev=shiftIn(e._prev,r?s:u);return a}function shiftIn(e,t){var r=e.length,n=-1,i=new Buffer(e.length);for(e=Buffer.concat([e,new Buffer([t])]);++n<r;)i[n]=e[n]<<1|e[n+1]>>7;return i}exports.encrypt=function(e,t,r){for(var n=t.length,i=new Buffer(n),o=-1;++o<n;)i[o]=encryptByte(e,t[o],r);return i};