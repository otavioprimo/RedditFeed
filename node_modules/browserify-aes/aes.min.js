function fixup_uint32(t){var e,n;return e=t>uint_max||0>t?(n=Math.abs(t)%uint_max,0>t?uint_max-n:n):t}function scrub_vec(t){for(var e=0;e<t.length;t++)t[e]=0;return!1}function Global(){this.SBOX=[],this.INV_SBOX=[],this.SUB_MIX=[[],[],[],[]],this.INV_SUB_MIX=[[],[],[],[]],this.init(),this.RCON=[0,1,2,4,8,16,32,64,128,27,54]}function bufferToArray(t){for(var e=t.length/4,n=new Array(e),r=-1;++r<e;)n[r]=t.readUInt32BE(4*r);return n}function AES(t){this._key=bufferToArray(t),this._doReset()}var uint_max=Math.pow(2,32);Global.prototype.init=function(){var t,e,n,r,i,o,s,a,c,l;for(t=function(){var t,n;for(n=[],e=t=0;256>t;e=++t)128>e?n.push(e<<1):n.push(e<<1^283);return n}(),i=0,c=0,e=l=0;256>l;e=++l)n=c^c<<1^c<<2^c<<3^c<<4,n=n>>>8^255&n^99,this.SBOX[i]=n,this.INV_SBOX[n]=i,o=t[i],s=t[o],a=t[s],r=257*t[n]^16843008*n,this.SUB_MIX[0][i]=r<<24|r>>>8,this.SUB_MIX[1][i]=r<<16|r>>>16,this.SUB_MIX[2][i]=r<<8|r>>>24,this.SUB_MIX[3][i]=r,r=16843009*a^65537*s^257*o^16843008*i,this.INV_SUB_MIX[0][n]=r<<24|r>>>8,this.INV_SUB_MIX[1][n]=r<<16|r>>>16,this.INV_SUB_MIX[2][n]=r<<8|r>>>24,this.INV_SUB_MIX[3][n]=r,0===i?i=c=1:(i=o^t[t[t[a^o]]],c^=t[t[c]]);return!0};var G=new Global;AES.blockSize=16,AES.prototype.blockSize=AES.blockSize,AES.keySize=32,AES.prototype.keySize=AES.keySize,AES.prototype._doReset=function(){var t,e,n,r,i,o;for(n=this._key,e=n.length,this._nRounds=e+6,i=4*(this._nRounds+1),this._keySchedule=[],r=0;i>r;r++)this._keySchedule[r]=e>r?n[r]:(o=this._keySchedule[r-1],r%e===0?(o=o<<8|o>>>24,o=G.SBOX[o>>>24]<<24|G.SBOX[o>>>16&255]<<16|G.SBOX[o>>>8&255]<<8|G.SBOX[255&o],o^=G.RCON[r/e|0]<<24):e>6&&r%e===4?o=G.SBOX[o>>>24]<<24|G.SBOX[o>>>16&255]<<16|G.SBOX[o>>>8&255]<<8|G.SBOX[255&o]:void 0,this._keySchedule[r-e]^o);for(this._invKeySchedule=[],t=0;i>t;t++)r=i-t,o=this._keySchedule[r-(t%4?0:4)],this._invKeySchedule[t]=4>t||4>=r?o:G.INV_SUB_MIX[0][G.SBOX[o>>>24]]^G.INV_SUB_MIX[1][G.SBOX[o>>>16&255]]^G.INV_SUB_MIX[2][G.SBOX[o>>>8&255]]^G.INV_SUB_MIX[3][G.SBOX[255&o]];return!0},AES.prototype.encryptBlock=function(t){t=bufferToArray(new Buffer(t));var e=this._doCryptBlock(t,this._keySchedule,G.SUB_MIX,G.SBOX),n=new Buffer(16);return n.writeUInt32BE(e[0],0),n.writeUInt32BE(e[1],4),n.writeUInt32BE(e[2],8),n.writeUInt32BE(e[3],12),n},AES.prototype.decryptBlock=function(t){t=bufferToArray(new Buffer(t));var e=[t[3],t[1]];t[1]=e[0],t[3]=e[1];var n=this._doCryptBlock(t,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX),r=new Buffer(16);return r.writeUInt32BE(n[0],0),r.writeUInt32BE(n[3],4),r.writeUInt32BE(n[2],8),r.writeUInt32BE(n[1],12),r},AES.prototype.scrub=function(){scrub_vec(this._keySchedule),scrub_vec(this._invKeySchedule),scrub_vec(this._key)},AES.prototype._doCryptBlock=function(t,e,n,r){var i,o,s,a,c,l,u,h,p;o=t[0]^e[0],s=t[1]^e[1],a=t[2]^e[2],c=t[3]^e[3],i=4;for(var f=1;f<this._nRounds;f++)l=n[0][o>>>24]^n[1][s>>>16&255]^n[2][a>>>8&255]^n[3][255&c]^e[i++],u=n[0][s>>>24]^n[1][a>>>16&255]^n[2][c>>>8&255]^n[3][255&o]^e[i++],h=n[0][a>>>24]^n[1][c>>>16&255]^n[2][o>>>8&255]^n[3][255&s]^e[i++],p=n[0][c>>>24]^n[1][o>>>16&255]^n[2][s>>>8&255]^n[3][255&a]^e[i++],o=l,s=u,a=h,c=p;return l=(r[o>>>24]<<24|r[s>>>16&255]<<16|r[a>>>8&255]<<8|r[255&c])^e[i++],u=(r[s>>>24]<<24|r[a>>>16&255]<<16|r[c>>>8&255]<<8|r[255&o])^e[i++],h=(r[a>>>24]<<24|r[c>>>16&255]<<16|r[o>>>8&255]<<8|r[255&s])^e[i++],p=(r[c>>>24]<<24|r[o>>>16&255]<<16|r[s>>>8&255]<<8|r[255&a])^e[i++],[fixup_uint32(l),fixup_uint32(u),fixup_uint32(h),fixup_uint32(p)]},exports.AES=AES;