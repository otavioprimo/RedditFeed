function PathVisitor(){if(!(this instanceof PathVisitor))throw new Error("PathVisitor constructor cannot be invoked without 'new'");this._reusableContextStack=[],this._methodNameTable=computeMethodNameTable(this),this._shouldVisitComments=hasOwn.call(this._methodNameTable,"Block")||hasOwn.call(this._methodNameTable,"Line"),this.Context=makeContextConstructor(this),this._visiting=!1,this._changeReported=!1}function computeMethodNameTable(e){var t=Object.create(null);for(var r in e)/^visit[A-Z]/.test(r)&&(t[r.slice("visit".length)]=!0);for(var n=types.computeSupertypeLookupTable(t),i=Object.create(null),t=Object.keys(n),o=t.length,s=0;o>s;++s){var a=t[s];r="visit"+n[a],isFunction.check(e[r])&&(i[a]=r)}return i}function extend(e,t){for(var r in t)hasOwn.call(t,r)&&(e[r]=t[r]);return e}function visitChildren(e,t){if(!(e instanceof NodePath))throw new Error("");if(!(t instanceof PathVisitor))throw new Error("");var r=e.value;if(isArray.check(r))e.each(t.visitWithoutReset,t);else if(isObject.check(r)){var n=types.getFieldNames(r);t._shouldVisitComments&&r.comments&&n.indexOf("comments")<0&&n.push("comments");for(var i=n.length,o=[],s=0;i>s;++s){var a=n[s];hasOwn.call(r,a)||(r[a]=types.getFieldValue(r,a)),o.push(e.get(a))}for(var s=0;i>s;++s)t.visitWithoutReset(o[s])}else;return e.value}function makeContextConstructor(e){function t(r){if(!(this instanceof t))throw new Error("");if(!(this instanceof PathVisitor))throw new Error("");if(!(r instanceof NodePath))throw new Error("");Object.defineProperty(this,"visitor",{value:e,writable:!1,enumerable:!0,configurable:!1}),this.currentPath=r,this.needToCallTraverse=!0,Object.seal(this)}if(!(e instanceof PathVisitor))throw new Error("");var r=t.prototype=Object.create(e);return r.constructor=t,extend(r,sharedContextProtoMethods),t}var types=require("./types"),NodePath=require("./node-path"),Printable=types.namedTypes.Printable,isArray=types.builtInTypes.array,isObject=types.builtInTypes.object,isFunction=types.builtInTypes["function"],hasOwn=Object.prototype.hasOwnProperty,undefined;PathVisitor.fromMethodsObject=function(e){function t(){if(!(this instanceof t))throw new Error("Visitor constructor cannot be invoked without 'new'");PathVisitor.call(this)}if(e instanceof PathVisitor)return e;if(!isObject.check(e))return new PathVisitor;var r=t.prototype=Object.create(PVp);return r.constructor=t,extend(r,e),extend(t,PathVisitor),isFunction.assert(t.fromMethodsObject),isFunction.assert(t.visit),new t},PathVisitor.visit=function(e,t){return PathVisitor.fromMethodsObject(t).visit(e)};var PVp=PathVisitor.prototype;PVp.visit=function(){if(this._visiting)throw new Error("Recursively calling visitor.visit(path) resets visitor state. Try this.visit(path) or this.traverse(path) instead.");this._visiting=!0,this._changeReported=!1,this._abortRequested=!1;for(var e=arguments.length,t=new Array(e),r=0;e>r;++r)t[r]=arguments[r];t[0]instanceof NodePath||(t[0]=new NodePath({root:t[0]}).get("root")),this.reset.apply(this,t);try{var n=this.visitWithoutReset(t[0]),i=!0}finally{if(this._visiting=!1,!i&&this._abortRequested)return t[0].value}return n},PVp.AbortRequest=function(){},PVp.abort=function(){var e=this;e._abortRequested=!0;var t=new e.AbortRequest;throw t.cancel=function(){e._abortRequested=!1},t},PVp.reset=function(e){},PVp.visitWithoutReset=function(e){if(this instanceof this.Context)return this.visitor.visitWithoutReset(e);if(!(e instanceof NodePath))throw new Error("");var t=e.value,r=t&&"object"==typeof t&&"string"==typeof t.type&&this._methodNameTable[t.type];if(!r)return visitChildren(e,this);var n=this.acquireContext(e);try{return n.invokeVisitorMethod(r)}finally{this.releaseContext(n)}},PVp.acquireContext=function(e){return 0===this._reusableContextStack.length?new this.Context(e):this._reusableContextStack.pop().reset(e)},PVp.releaseContext=function(e){if(!(e instanceof this.Context))throw new Error("");this._reusableContextStack.push(e),e.currentPath=null},PVp.reportChanged=function(){this._changeReported=!0},PVp.wasChangeReported=function(){return this._changeReported};var sharedContextProtoMethods=Object.create(null);sharedContextProtoMethods.reset=function(e){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof NodePath))throw new Error("");return this.currentPath=e,this.needToCallTraverse=!0,this},sharedContextProtoMethods.invokeVisitorMethod=function(e){if(!(this instanceof this.Context))throw new Error("");if(!(this.currentPath instanceof NodePath))throw new Error("");var t=this.visitor[e].call(this,this.currentPath);if(t===!1?this.needToCallTraverse=!1:t!==undefined&&(this.currentPath=this.currentPath.replace(t)[0],this.needToCallTraverse&&this.traverse(this.currentPath)),this.needToCallTraverse!==!1)throw new Error("Must either call this.traverse or return false in "+e);var r=this.currentPath;return r&&r.value},sharedContextProtoMethods.traverse=function(e,t){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof NodePath))throw new Error("");if(!(this.currentPath instanceof NodePath))throw new Error("");return this.needToCallTraverse=!1,visitChildren(e,PathVisitor.fromMethodsObject(t||this.visitor))},sharedContextProtoMethods.visit=function(e,t){if(!(this instanceof this.Context))throw new Error("");if(!(e instanceof NodePath))throw new Error("");if(!(this.currentPath instanceof NodePath))throw new Error("");return this.needToCallTraverse=!1,PathVisitor.fromMethodsObject(t||this.visitor).visitWithoutReset(e)},sharedContextProtoMethods.reportChanged=function(){this.visitor.reportChanged()},sharedContextProtoMethods.abort=function(){this.needToCallTraverse=!1,this.visitor.abort()},module.exports=PathVisitor;