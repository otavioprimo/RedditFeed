function nodeModulesPaths(t,e){for(var n="win32"===process.platform?/[\/\\]/:/\/+/,r=t.split(n),i=[],o=r.length-1;o>=0;o--)if("node_modules"!==r[o]){var s=path.join.apply(path,r.slice(0,o+1).concat(["node_modules"]));r[0].match(/([A-Za-z]:)/)||(s="/"+s),i.push(s)}return i}function find_shims_in_package(t,e,n,r){try{var i=JSON.parse(t)}catch(o){throw o.message=t+" : "+o.message,o}var s=getReplacements(i,r);if(s){if("string"==typeof s){var a=path.resolve(e,i.main||"index.js");return void(n[a]=path.resolve(e,s))}Object.keys(s).forEach(function(t){var r;s[t]===!1?r=__dirname+"/empty.js":(r=s[t],"."===r[0]&&(r=path.resolve(e,r))),("/"===t[0]||"."===t[0])&&(t=path.resolve(e,t)),n[t]=r}),[".js",".json"].forEach(function(t){Object.keys(n).forEach(function(e){n[e+t]||(n[e+t]=n[e])})})}}function load_shims(t,e,n){var r=Object.create(null);!function i(){var o=t.shift();if(!o)return n(null,r);var s=path.join(o,"package.json");fs.readFile(s,"utf8",function(t,s){if(t)return"ENOENT"===t.code?i():n(t);try{return find_shims_in_package(s,o,r,e),n(null,r)}catch(t){return n(t)}})}()}function load_shims_sync(t,e){for(var r,n=Object.create(null);r=t.shift();){var i=path.join(r,"package.json");try{var o=fs.readFileSync(i,"utf8");return find_shims_in_package(o,r,n,e),n}catch(s){if("ENOENT"===s.code)continue;throw s}}return n}function build_resolve_opts(t,e){var n=t.packageFilter,r=normalizeBrowserFieldName(t.browser);t.basedir=e,t.packageFilter=function(t,e){n&&(t=n(t,e));var i=getReplacements(t,r);if(!i)return t;if(t[r]=i,"string"==typeof i)return t.main=i,t;var o=i[t.main||"./index.js"]||i["./"+t.main||"./index.js"];return t.main=o||t.main,t};var i=t.pathFilter;return t.pathFilter=function(t,e,n){"."!=n[0]&&(n="./"+n);var o;if(i&&(o=i.apply(this,arguments)),o)return o;var s=t[r];return s?(o=s[n],o||""!==path.extname(n)||(o=s[n+".js"],o||(o=s[n+".json"])),o):void 0},t}function resolve(t,e,n){e=e||{},e.filename=e.filename||"";var r=path.dirname(e.filename);e.basedir&&(r=e.basedir);var i=nodeModulesPaths(r);e.paths&&i.push.apply(i,e.paths),i=i.map(function(t){return path.dirname(t)}),load_shims(i,e.browser,function(i,o){if(i)return n(i);var s=path.resolve(e.basedir||path.dirname(e.filename),t);if(o[t]||o[s]){var a=o[t]?t:s;if("/"===o[a][0])return resv(o[a],build_resolve_opts(e,r),function(t,e,r){n(null,e,r)});t=o[a]}var c=e.modules||Object.create(null),l=c[t];if(l)return n(null,l);resv(t,build_resolve_opts(e,r),function(t,e,r){if(t)return n(t);var i=o?o[e]||e:e;n(null,i,r)})})}function normalizeBrowserFieldName(t){return t||"browser"}function getReplacements(t,e){e=normalizeBrowserFieldName(e);var n=t[e]||t.browser;return"string"!=typeof t.browserify||n||(n=t.browserify),n}var fs=require("fs"),path=require("path"),resv=require("resolve");resolve.sync=function(t,e){e=e||{},e.filename=e.filename||"";var n=path.dirname(e.filename);e.basedir&&(n=e.basedir);var r=nodeModulesPaths(n);e.paths&&r.push.apply(r,e.paths),r=r.map(function(t){return path.dirname(t)});var i=load_shims_sync(r,e.browser);if(i[t]){if("/"===i[t][0])return i[t];t=i[t]}var o=e.modules||Object.create(null),s=o[t];if(s)return s;var a=resv.sync(t,build_resolve_opts(e,n));return i?i[a]||a:a},module.exports=resolve;