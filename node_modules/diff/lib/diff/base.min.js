"use strict";function Diff(){}function buildValues(e,t,r,n,i){for(var a=0,o=t.length,s=0,u=0;o>a;a++){var l=t[a];if(l.removed){if(l.value=n.slice(u,u+l.count).join(""),u+=l.count,a&&t[a-1].added){var f=t[a-1];t[a-1]=t[a],t[a]=f}}else{if(!l.added&&i){var c=r.slice(s,s+l.count);c=c.map(function(e,t){var r=n[u+t];return r.length>e.length?r:e}),l.value=c.join("")}else l.value=r.slice(s,s+l.count).join("");s+=l.count,l.added||(u+=l.count)}}var p=t[o-1];return o>1&&(p.added||p.removed)&&e.equals("",p.value)&&(t[o-2].value+=p.value,t.pop()),t}function clonePath(e){return{newPos:e.newPos,components:e.components.slice(0)}}exports.__esModule=!0,exports["default"]=Diff,Diff.prototype={diff:function(e,t){function a(e){return n?(setTimeout(function(){n(void 0,e)},0),!0):e}function p(){for(var r=-1*u;u>=r;r+=2){var n=void 0,l=c[r-1],f=c[r+1],p=(f?f.newPos:0)-r;l&&(c[r-1]=void 0);var h=l&&l.newPos+1<o,d=f&&p>=0&&s>p;if(h||d){if(!h||d&&l.newPos<f.newPos?(n=clonePath(f),i.pushComponent(n.components,void 0,!0)):(n=l,n.newPos++,i.pushComponent(n.components,!0,void 0)),p=i.extractCommon(n,t,e,r),n.newPos+1>=o&&p+1>=s)return a(buildValues(i,n.components,t,e,i.useLongestToken));c[r]=n}else c[r]=void 0}u++}var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=r.callback;"function"==typeof r&&(n=r,r={}),this.options=r;var i=this;e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e)),t=this.removeEmpty(this.tokenize(t));var o=t.length,s=e.length,u=1,l=o+s,c=[{newPos:-1,components:[]}],f=this.extractCommon(c[0],t,e,0);if(c[0].newPos+1>=o&&f+1>=s)return a([{value:t.join(""),count:t.length}]);if(n)!function d(){setTimeout(function(){return u>l?n():void(p()||d())},0)}();else for(;l>=u;){var h=p();if(h)return h}},pushComponent:function(e,t,r){var n=e[e.length-1];n&&n.added===t&&n.removed===r?e[e.length-1]={count:n.count+1,added:t,removed:r}:e.push({count:1,added:t,removed:r})},extractCommon:function(e,t,r,n){for(var i=t.length,a=r.length,o=e.newPos,s=o-n,u=0;i>o+1&&a>s+1&&this.equals(t[o+1],r[s+1]);)o++,s++,u++;return u&&e.components.push({count:u}),e.newPos=o,s},equals:function(e,t){return e===t},removeEmpty:function(e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")}};