"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function applyPatch(e,t){function p(e,t){for(var r=0;r<e.lines.length;r++){var i=e.lines[r],u=i[0],l=i.substr(1);if(" "===u||"-"===u){if(!a(t+1,n[t],u,l)&&(o++,o>s))return!1;t++}}return!0}var r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if("string"==typeof t&&(t=_parse.parsePatch(t)),Array.isArray(t)){if(t.length>1)throw new Error("applyPatch only works with a single input.");t=t[0]}for(var n=e.split("\n"),i=t.hunks,a=r.compareLine||function(e,t,r,n){return t===n},o=0,s=r.fuzzFactor||0,u=0,l=0,c=void 0,f=void 0,h=0;h<i.length;h++){for(var d=i[h],v=n.length-d.oldLines,m=0,g=l+d.oldStart-1,y=_distanceIterator2["default"](g,u,v);void 0!==m;m=y())if(p(d,g+m)){d.offset=l+=m;break}if(void 0===m)return!1;u=d.offset+d.oldStart+d.oldLines}for(var b=0;b<i.length;b++){var _=i[b],w=_.offset+_.newStart-1;0==_.newLines&&w++;for(var x=0;x<_.lines.length;x++){var E=_.lines[x],S=E[0],k=E.substr(1);if(" "===S)w++;else if("-"===S)n.splice(w,1);else if("+"===S)n.splice(w,0,k),w++;else if("\\"===S){var C=_.lines[x-1]?_.lines[x-1][0]:null;"+"===C?c=!0:"-"===C&&(f=!0)}}}if(c)for(;!n[n.length-1];)n.pop();else f&&n.push("");return n.join("\n")}function applyPatches(e,t){function n(){var i=e[r++];return i?void t.loadFile(i,function(e,r){if(e)return t.complete(e);var a=applyPatch(r,i,t);t.patched(i,a),setTimeout(n,0)}):t.complete()}"string"==typeof e&&(e=_parse.parsePatch(e));var r=0;n()}exports.__esModule=!0,exports.applyPatch=applyPatch,exports.applyPatches=applyPatches;var _parse=require("./parse"),_distanceIterator=require("../util/distance-iterator"),_distanceIterator2=_interopRequireDefault(_distanceIterator);