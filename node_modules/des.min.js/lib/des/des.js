"use strict";function DESState(){this.tmp=new Array(2),this.keys=null}function DES(e){Cipher.call(this,e);var t=new DESState;this._desState=t,this.deriveKeys(t,e.key)}var assert=require("minimalistic-assert"),inherits=require("inherits"),des=require("../des"),utils=des.utils,Cipher=des.Cipher;inherits(DES,Cipher),module.exports=DES,DES.create=function(e){return new DES(e)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES.prototype.deriveKeys=function(e,t){e.keys=new Array(32),assert.equal(t.length,this.blockSize,"Invalid key length");var r=utils.readUInt32BE(t,0),n=utils.readUInt32BE(t,4);utils.pc1(r,n,e.tmp,0),r=e.tmp[0],n=e.tmp[1];for(var i=0;i<e.keys.length;i+=2){var a=shiftTable[i>>>1];r=utils.r28shl(r,a),n=utils.r28shl(n,a),utils.pc2(r,n,e.keys,i)}},DES.prototype._update=function(e,t,r,n){var i=this._desState,a=utils.readUInt32BE(e,t),o=utils.readUInt32BE(e,t+4);utils.ip(a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],"encrypt"===this.type?this._encrypt(i,a,o,i.tmp,0):this._decrypt(i,a,o,i.tmp,0),a=i.tmp[0],o=i.tmp[1],utils.writeUInt32BE(r,a,n),utils.writeUInt32BE(r,o,n+4)},DES.prototype._pad=function(e,t){for(var r=e.length-t,n=t;n<e.length;n++)e[n]=r;return!0},DES.prototype._unpad=function(e){for(var t=e[e.length-1],r=e.length-t;r<e.length;r++)assert.equal(e[r],t);return e.slice(0,e.length-t)},DES.prototype._encrypt=function(e,t,r,n,i){for(var a=t,o=r,s=0;s<e.keys.length;s+=2){var u=e.keys[s],l=e.keys[s+1];utils.expand(o,e.tmp,0),u^=e.tmp[0],l^=e.tmp[1];var c=utils.substitute(u,l),f=utils.permute(c),p=o;o=(a^f)>>>0,a=p}utils.rip(o,a,n,i)},DES.prototype._decrypt=function(e,t,r,n,i){for(var a=r,o=t,s=e.keys.length-2;s>=0;s-=2){var u=e.keys[s],l=e.keys[s+1];utils.expand(a,e.tmp,0),u^=e.tmp[0],l^=e.tmp[1];var c=utils.substitute(u,l),f=utils.permute(c),p=a;a=(o^f)>>>0,o=p}utils.rip(a,o,n,i)};