function BufferStream(){this.chunks=[],this.length=0,this.writable=!0,this.readable=!0}function SlowStream(e){this.trickle=e,this.offset=0,this.readable=this.writable=!0}var assert=require("assert"),zlib=require("../"),path=require("path"),zlibPairs=[[zlib.Deflate,zlib.Inflate],[zlib.Gzip,zlib.Gunzip],[zlib.Deflate,zlib.Unzip],[zlib.Gzip,zlib.Unzip],[zlib.DeflateRaw,zlib.InflateRaw]],trickle=[128,1024,1048576],chunkSize=[128,1024,16384,1048576],level=[-1,0,1,2,3,4,5,6,7,8,9],windowBits=[8,9,10,11,12,13,14,15],memLevel=[1,2,3,4,5,6,7,8,9],strategy=[0,1,2,3,4];process.env.PUMMEL||(trickle=[1024],chunkSize=[16384],level=[6],memLevel=[8],windowBits=[15],strategy=[0]);var fs=require("fs");process.env.FAST&&(zlibPairs=[[zlib.Gzip,zlib.Unzip]]);var tests={"person.jpg":fs.readFileSync(__dirname+"/fixtures/person.jpg"),"elipses.txt":fs.readFileSync(__dirname+"/fixtures/elipses.txt"),"empty.txt":fs.readFileSync(__dirname+"/fixtures/empty.txt")},util=require("util"),stream=require("stream");util.inherits(BufferStream,stream.Stream),BufferStream.prototype.write=function(e){return this.chunks.push(e),this.length+=e.length,!0},BufferStream.prototype.end=function(e){e&&this.write(e);var t=new Buffer(this.length),r=0;return this.chunks.forEach(function(e){e.copy(t,r),r+=e.length}),this.emit("data",t),this.emit("end"),!0},util.inherits(SlowStream,stream.Stream),SlowStream.prototype.write=function(){throw new Error("not implemented, just call ss.end(chunk)")},SlowStream.prototype.pause=function(){this.paused=!0,this.emit("pause")},SlowStream.prototype.resume=function(){function t(){if(!e.paused){if(e.offset>=e.length)return e.ended=!0,e.emit("end");var r=Math.min(e.offset+e.trickle,e.length),n=e.chunk.slice(e.offset,r);e.offset+=n.length,e.emit("data",n),process.nextTick(t)}}var e=this;e.ended||(e.emit("resume"),e.chunk&&(e.paused=!1,t()))},SlowStream.prototype.end=function(e){var t=this;return t.chunk=e,t.length=e.length,t.resume(),t.ended};var tape=require("tape");Object.keys(tests).forEach(function(e){var t=tests[e];chunkSize.forEach(function(r){trickle.forEach(function(n){windowBits.forEach(function(i){level.forEach(function(o){memLevel.forEach(function(a){strategy.forEach(function(s){zlibPairs.forEach(function(u){var l=u[0],c=u[1],f={level:o,windowBits:i,memLevel:a,strategy:s},p=e+" "+r+" "+JSON.stringify(f)+" "+l.name+" -> "+c.name;tape("zlib "+p,function(e){e.plan(1);var r=new l(f),i=new c(f),o=new SlowStream(n),a=new BufferStream;a.on("data",function(r){e.deepEqual(r,t)}),o.pipe(r).pipe(i).pipe(a),o.end(t)})})})})})})})})});