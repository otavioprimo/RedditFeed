function glob(t,e,n){if("function"==typeof e&&(n=e,e={}),e||(e={}),e.sync){if(n)throw new TypeError("callback provided to sync glob");return globSync(t,e)}return new Glob(t,e,n)}function extend(t,e){if(null===e||"object"!=typeof e)return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}function Glob(t,e,n){function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}if("function"==typeof e&&(n=e,e=null),e&&e.sync){if(n)throw new TypeError("callback provided to sync glob");return new GlobSync(t,e)}if(!(this instanceof Glob))return new Glob(t,e,n);setopts(this,t,e),this._didRealPath=!1;var r=this.minimatch.set.length;this.matches=new Array(r),"function"==typeof n&&(n=once(n),this.on("error",n),this.on("end",function(t){n(null,t)}));var i=this,r=this.minimatch.set.length;if(this._processing=0,this.matches=new Array(r),this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(0===r)return a();for(var o=!0,s=0;r>s;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1}function readdirCb(t,e,n){return function(r,i){r?t._readdirError(e,r,n):t._readdirEntries(e,i,n)}}module.exports=glob;var fs=require("fs"),rp=require("fs.realpath"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,inherits=require("inherits"),EE=require("events").EventEmitter,path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),globSync=require("./sync.js"),common=require("./common.js"),alphasort=common.alphasort,alphasorti=common.alphasorti,setopts=common.setopts,ownProp=common.ownProp,inflight=require("inflight"),util=require("util"),childrenIgnored=common.childrenIgnored,isIgnored=common.isIgnored,once=require("once");glob.sync=globSync;var GlobSync=glob.GlobSync=globSync.GlobSync;glob.glob=glob,glob.hasMagic=function(t,e){var n=extend({},e);n.noprocess=!0;var r=new Glob(t,n),i=r.minimatch.set;if(!t)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if("string"!=typeof i[0][o])return!0;return!1},glob.Glob=Glob,inherits(Glob,EE),Glob.prototype._finish=function(){if(assert(this instanceof Glob),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();common.finish(this),this.emit("end",this.found)}},Glob.prototype._realpath=function(){function r(){0===--t&&e._finish()}if(!this._didRealpath){this._didRealpath=!0;var t=this.matches.length;if(0===t)return this._finish();for(var e=this,n=0;n<this.matches.length;n++)this._realpathSet(n,r)}},Glob.prototype._realpathSet=function(t,e){var n=this.matches[t];if(!n)return e();var r=Object.keys(n),i=this,o=r.length;if(0===o)return e();var s=this.matches[t]=Object.create(null);r.forEach(function(n,r){n=i._makeAbs(n),rp.realpath(n,i.realpathCache,function(r,a){r?"stat"===r.syscall?s[n]=!0:i.emit("error",r):s[a]=!0,0===--o&&(i.matches[t]=s,e())})})},Glob.prototype._mark=function(t){return common.mark(this,t)},Glob.prototype._makeAbs=function(t){return common.makeAbs(this,t)},Glob.prototype.abort=function(){this.aborted=!0,this.emit("abort")},Glob.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))},Glob.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var t=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<t.length;e++){var n=t[e];this._emitMatch(n[0],n[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<r.length;e++){var i=r[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}},Glob.prototype._process=function(t,e,n,r){if(assert(this instanceof Glob),assert("function"==typeof r),!this.aborted){if(this._processing++,this.paused)return void this._processQueue.push([t,e,n,r]);for(var i=0;"string"==typeof t[i];)i++;var o;switch(i){case t.length:return void this._processSimple(t.join("/"),e,r);case 0:o=null;break;default:o=t.slice(0,i).join("/")}var a,s=t.slice(i);null===o?a=".":isAbsolute(o)||isAbsolute(t.join("/"))?(o&&isAbsolute(o)||(o="/"+o),a=o):a=o;var c=this._makeAbs(a);if(childrenIgnored(this,a))return r();var l=s[0]===minimatch.GLOBSTAR;l?this._processGlobStar(o,a,c,s,e,n,r):this._processReaddir(o,a,c,s,e,n,r)}},Glob.prototype._processReaddir=function(t,e,n,r,i,o,s){var a=this;this._readdir(n,o,function(c,l){return a._processReaddir2(t,e,n,r,i,o,l,s)})},Glob.prototype._processReaddir2=function(t,e,n,r,i,o,s,a){if(!s)return a();for(var c=r[0],l=!!this.minimatch.negate,u=c._glob,h=this.dot||"."===u.charAt(0),p=[],f=0;f<s.length;f++){var d=s[f];if("."!==d.charAt(0)||h){var _;_=l&&!t?!d.match(c):d.match(c),_&&p.push(d)}}var g=p.length;if(0===g)return a();if(1===r.length&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;g>f;f++){var d=p[f];t&&(d="/"!==t?t+"/"+d:t+d),"/"!==d.charAt(0)||this.nomount||(d=path.join(this.root,d)),this._emitMatch(i,d)}return a()}r.shift();for(var f=0;g>f;f++){var d=p[f];t&&(d="/"!==t?t+"/"+d:t+d),this._process([d].concat(r),i,o,a)}a()},Glob.prototype._emitMatch=function(t,e){if(!this.aborted&&!isIgnored(this,e)){if(this.paused)return void this._emitQueue.push([t,e]);var n=isAbsolute(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=n),!this.matches[t][e]){if(this.nodir){var r=this.cache[n];if("DIR"===r||Array.isArray(r))return}this.matches[t][e]=!0;var i=this.statCache[n];i&&this.emit("stat",e,i),this.emit("match",e)}}},Glob.prototype._readdirInGlobStar=function(t,e){function o(n,i){if(n&&"ENOENT"===n.code)return e();var o=i&&i.isSymbolicLink();r.symlinks[t]=o,o||!i||i.isDirectory()?r._readdir(t,!1,e):(r.cache[t]="FILE",e())}if(!this.aborted){if(this.follow)return this._readdir(t,!1,e);var n="lstat\x00"+t,r=this,i=inflight(n,o);i&&fs.lstat(t,i)}},Glob.prototype._readdir=function(t,e,n){if(!this.aborted&&(n=inflight("readdir\x00"+t+"\x00"+e,n))){if(e&&!ownProp(this.symlinks,t))return this._readdirInGlobStar(t,n);if(ownProp(this.cache,t)){var r=this.cache[t];if(!r||"FILE"===r)return n();if(Array.isArray(r))return n(null,r)}fs.readdir(t,readdirCb(this,t,n))}},Glob.prototype._readdirEntries=function(t,e,n){if(!this.aborted){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];i="/"===t?t+i:t+"/"+i,this.cache[i]=!0}return this.cache[t]=e,n(null,e)}},Glob.prototype._readdirError=function(t,e,n){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(t);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:this.cache[this._makeAbs(t)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e)}return n()}},Glob.prototype._processGlobStar=function(t,e,n,r,i,o,s){var a=this;this._readdir(n,o,function(c,l){a._processGlobStar2(t,e,n,r,i,o,l,s)})},Glob.prototype._processGlobStar2=function(t,e,n,r,i,o,s,a){if(!s)return a();var c=r.slice(1),l=t?[t]:[],u=l.concat(c);this._process(u,i,!1,a);var h=this.symlinks[n],p=s.length;if(h&&o)return a();for(var f=0;p>f;f++){var d=s[f];if("."!==d.charAt(0)||this.dot){var _=l.concat(s[f],c);this._process(_,i,!0,a);var g=l.concat(s[f],r);this._process(g,i,!0,a)}}a()},Glob.prototype._processSimple=function(t,e,n){var r=this;this._stat(t,function(i,o){r._processSimple2(t,e,i,o,n)})},Glob.prototype._processSimple2=function(t,e,n,r,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!r)return i();if(t&&isAbsolute(t)&&!this.nomount){var o=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=path.join(this.root,t):(t=path.resolve(this.root,t),o&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t),i()},Glob.prototype._stat=function(t,e){function u(r,i){return i&&i.isSymbolicLink()?fs.stat(n,function(r,o){r?c._stat2(t,n,null,i,e):c._stat2(t,n,r,o,e)}):void c._stat2(t,n,r,i,e)}var n=this._makeAbs(t),r="/"===t.slice(-1);if(t.length>this.maxLength)return e();if(!this.stat&&ownProp(this.cache,n)){var i=this.cache[n];if(Array.isArray(i)&&(i="DIR"),!r||"DIR"===i)return e(null,i);if(r&&"FILE"===i)return e()}var s=this.statCache[n];if(void 0!==s){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return r&&"FILE"===a?e():e(null,a,s)}var c=this,l=inflight("stat\x00"+n,u);l&&fs.lstat(n,l)},Glob.prototype._stat2=function(t,e,n,r,i){if(n&&("ENOENT"===n.code||"ENOTDIR"===n.code))return this.statCache[e]=!1,i();var o="/"===t.slice(-1);if(this.statCache[e]=r,"/"===e.slice(-1)&&r&&!r.isDirectory())return i(null,!1,r);var s=!0;return r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&"FILE"===s?i():i(null,s,r)};