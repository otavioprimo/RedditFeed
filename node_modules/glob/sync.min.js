function globSync(t,e){if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new GlobSync(t,e).found}function GlobSync(t,e){if(!t)throw new Error("must provide pattern");if("function"==typeof e||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof GlobSync))return new GlobSync(t,e);if(setopts(this,t,e),this.noprocess)return this;var n=this.minimatch.set.length;this.matches=new Array(n);for(var r=0;n>r;r++)this._process(this.minimatch.set[r],r,!1);this._finish()}module.exports=globSync,globSync.GlobSync=GlobSync;var fs=require("fs"),rp=require("fs.realpath"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,Glob=require("./glob.js").Glob,util=require("util"),path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),common=require("./common.js"),alphasort=common.alphasort,alphasorti=common.alphasorti,setopts=common.setopts,ownProp=common.ownProp,childrenIgnored=common.childrenIgnored,isIgnored=common.isIgnored;GlobSync.prototype._finish=function(){if(assert(this instanceof GlobSync),this.realpath){var t=this;this.matches.forEach(function(e,n){var r=t.matches[n]=Object.create(null);for(var i in e)try{i=t._makeAbs(i);var o=rp.realpathSync(i,t.realpathCache);r[o]=!0}catch(s){if("stat"!==s.syscall)throw s;r[t._makeAbs(i)]=!0}})}common.finish(this)},GlobSync.prototype._process=function(t,e,n){assert(this instanceof GlobSync);for(var r=0;"string"==typeof t[r];)r++;var i;switch(r){case t.length:return void this._processSimple(t.join("/"),e);case 0:i=null;break;default:i=t.slice(0,r).join("/")}var s,o=t.slice(r);null===i?s=".":isAbsolute(i)||isAbsolute(t.join("/"))?(i&&isAbsolute(i)||(i="/"+i),s=i):s=i;var a=this._makeAbs(s);if(!childrenIgnored(this,s)){var c=o[0]===minimatch.GLOBSTAR;c?this._processGlobStar(i,s,a,o,e,n):this._processReaddir(i,s,a,o,e,n)}},GlobSync.prototype._processReaddir=function(t,e,n,r,i,o){var s=this._readdir(n,o);if(s){for(var a=r[0],c=!!this.minimatch.negate,l=a._glob,u=this.dot||"."===l.charAt(0),h=[],p=0;p<s.length;p++){var f=s[p];if("."!==f.charAt(0)||u){var d;d=c&&!t?!f.match(a):f.match(a),d&&h.push(f)}}var _=h.length;if(0!==_)if(1!==r.length||this.mark||this.stat){r.shift();for(var p=0;_>p;p++){var g,f=h[p];g=t?[t,f]:[f],this._process(g.concat(r),i,o)}}else{this.matches[i]||(this.matches[i]=Object.create(null));for(var p=0;_>p;p++){var f=h[p];t&&(f="/"!==t.slice(-1)?t+"/"+f:t+f),"/"!==f.charAt(0)||this.nomount||(f=path.join(this.root,f)),this._emitMatch(i,f)}}}},GlobSync.prototype._emitMatch=function(t,e){if(!isIgnored(this,e)){var n=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=n),!this.matches[t][e]){if(this.nodir){var r=this.cache[n];if("DIR"===r||Array.isArray(r))return}this.matches[t][e]=!0,this.stat&&this._stat(e)}}},GlobSync.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var e,n;try{n=fs.lstatSync(t)}catch(i){if("ENOENT"===i.code)return null}var o=n&&n.isSymbolicLink();return this.symlinks[t]=o,o||!n||n.isDirectory()?e=this._readdir(t,!1):this.cache[t]="FILE",e},GlobSync.prototype._readdir=function(t,e){if(e&&!ownProp(this.symlinks,t))return this._readdirInGlobStar(t);if(ownProp(this.cache,t)){var r=this.cache[t];if(!r||"FILE"===r)return null;if(Array.isArray(r))return r}try{return this._readdirEntries(t,fs.readdirSync(t))}catch(i){return this._readdirError(t,i),null}},GlobSync.prototype._readdirEntries=function(t,e){if(!this.mark&&!this.stat)for(var n=0;n<e.length;n++){var r=e[n];r="/"===t?t+r:t+"/"+r,this.cache[r]=!0}return this.cache[t]=e,e},GlobSync.prototype._readdirError=function(t,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var n=this._makeAbs(t);if(this.cache[n]="FILE",n===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);throw r.path=this.cwd,r.code=e.code,r}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw e;this.silent||console.error("glob error",e)}},GlobSync.prototype._processGlobStar=function(t,e,n,r,i,o){var s=this._readdir(n,o);if(s){var a=r.slice(1),c=t?[t]:[],l=c.concat(a);this._process(l,i,!1);var u=s.length,h=this.symlinks[n];if(!h||!o)for(var p=0;u>p;p++){var f=s[p];if("."!==f.charAt(0)||this.dot){var d=c.concat(s[p],a);this._process(d,i,!0);var _=c.concat(s[p],r);this._process(_,i,!0)}}}},GlobSync.prototype._processSimple=function(t,e){var n=this._stat(t);if(this.matches[e]||(this.matches[e]=Object.create(null)),n){if(t&&isAbsolute(t)&&!this.nomount){var r=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=path.join(this.root,t):(t=path.resolve(this.root,t),r&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(e,t)}},GlobSync.prototype._stat=function(t){var e=this._makeAbs(t),n="/"===t.slice(-1);if(t.length>this.maxLength)return!1;if(!this.stat&&ownProp(this.cache,e)){var r=this.cache[e];if(Array.isArray(r)&&(r="DIR"),!n||"DIR"===r)return r;if(n&&"FILE"===r)return!1}var o=this.statCache[e];if(!o){var s;try{s=fs.lstatSync(e)}catch(a){if(a&&("ENOENT"===a.code||"ENOTDIR"===a.code))return this.statCache[e]=!1,!1}if(s&&s.isSymbolicLink())try{o=fs.statSync(e)}catch(a){o=s}else o=s}this.statCache[e]=o;var r=!0;return o&&(r=o.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||r,n&&"FILE"===r?!1:r},GlobSync.prototype._mark=function(t){return common.mark(this,t)},GlobSync.prototype._makeAbs=function(t){return common.makeAbs(this,t)};