"use strict";function createHttpServer(e){var t=express();return t.set("serveConfig",e),t.listen(e.httpPort,e.host,function(){logger_1.Logger.debug("listening on "+e.httpPort)}),t.get("/",serveIndex),t.use("/",express["static"](e.wwwDir)),t.use("/"+serve_config_1.LOGGER_DIR,express["static"](path.join(__dirname,"..","..","bin"),{maxAge:31536e3})),t.get(serve_config_1.IONIC_LAB_URL,function(e,t){return t.sendFile("ionic-lab.html",{root:path.join(__dirname,"..","..","bin")})}),t.get("/cordova.js",serveCordovaJS),e.useProxy&&setupProxies(t),t}function setupProxies(e){ionic_project_1.getProjectJson().then(function(t){for(var r=0,n=t.proxies||[];r<n.length;r++){var i=n[r],o=url.parse(i.proxyUrl);i.proxyNoAgent&&(o.agent=!1),o.rejectUnauthorized=!(i.rejectUnauthorized===!1),e.use(i.path,proxyMiddleware(o)),logger_1.Logger.info("Proxy added:",i.path+" => "+url.format(o))}})}function serveIndex(e,t){var r=e.app.get("serveConfig"),n=path.join(r.wwwDir,"index.html");fs.readFile(n,function(e,n){r.useLiveReload&&(n=live_reload_1.injectLiveReloadScript(n,r.host,r.liveReloadPort)),n=injector_1.injectNotificationScript(r.rootDir,n,r.notifyOnConsoleLog,r.notificationPort),n=logger_diagnostics_1.injectDiagnosticsHtml(r.buildDir,n),t.set("Content-Type","text/html"),t.send(n)})}function serveCordovaJS(e,t){t.set("Content-Type","application/javascript"),t.send("// mock cordova file during development")}var path=require("path"),injector_1=require("./injector"),live_reload_1=require("./live-reload"),express=require("express"),fs=require("fs"),url=require("url"),serve_config_1=require("./serve-config"),logger_1=require("../logger/logger"),proxyMiddleware=require("proxy-middleware"),logger_diagnostics_1=require("../logger/logger-diagnostics"),ionic_project_1=require("../util/ionic-project");exports.createHttpServer=createHttpServer;