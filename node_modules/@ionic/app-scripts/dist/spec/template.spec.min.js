"use strict";var logger_1=require("../logger/logger"),template_1=require("../template"),template_2=require("../template"),path_1=require("path"),mockFs=require("mock-fs");describe("template",function(){describe("inlineTemplate",function(){it("should inline multiple external html files which are the same for multiple @Components in same .ts file",function(){var e='/*someprefix*/@Component({templateUrl: "some-file.html" });/*somebetween*/@Component({templateUrl: "some-file.html" })/*somesuffix*/',t={"/path/to/dir":{"some-file.html":"<div>A</div>","some-file.scss":"body { color: red; }","some-file.ts":e}};mockFs(t);var r=template_1.inlineTemplate(e,"/path/to/dir/some-file.ts");expect(r).toEqual('/*someprefix*/@Component({template:/*ion-inline-start:"/path/to/dir/some-file.html"*/\'<div>A</div>\'/*ion-inline-end:"/path/to/dir/some-file.html"*/ });/*somebetween*/@Component({template:/*ion-inline-start:"/path/to/dir/some-file.html"*/\'<div>A</div>\'/*ion-inline-end:"/path/to/dir/some-file.html"*/ })/*somesuffix*/'),mockFs.restore()}),it("should inline multiple external html files with multiple @Components in same .ts file",function(){var e='/*someprefix*/@Component({templateUrl: "some-file1.html" });/*somebetween*/@Component({templateUrl: "some-file2.html" })/*somesuffix*/',t={"/path/to/dir":{"some-file1.html":"<div>A</div>","some-file2.html":"<div>B</div>","some-file.scss":"body { color: red; }","some-file.ts":e}};mockFs(t);var r=template_1.inlineTemplate(e,"/path/to/dir/some-file.ts");expect(r).toEqual('/*someprefix*/@Component({template:/*ion-inline-start:"/path/to/dir/some-file1.html"*/\'<div>A</div>\'/*ion-inline-end:"/path/to/dir/some-file1.html"*/ });/*somebetween*/@Component({template:/*ion-inline-start:"/path/to/dir/some-file2.html"*/\'<div>B</div>\'/*ion-inline-end:"/path/to/dir/some-file2.html"*/ })/*somesuffix*/'),mockFs.restore()}),it("should inline the external html file content",function(){var e='@Component({templateUrl: "some-file.html" })',t={"/path/to/dir":{"some-file.html":"<div>hello</div>","some-file.scss":"body { color: red; }","some-file.ts":e}};mockFs(t);var r=template_1.inlineTemplate(e,"/path/to/dir/some-file.ts");expect(r).toEqual('@Component({template:/*ion-inline-start:"/path/to/dir/some-file.html"*/\'<div>hello</div>\'/*ion-inline-end:"/path/to/dir/some-file.html"*/ })'),mockFs.restore()}),it("should do nothing for files with incomplete Component",function(){var e="\n        // Component this be bork\n      ",t="somefile.ts",r=template_1.inlineTemplate(e,t);expect(r).toEqual(e)}),it("should do nothing for files without Component",function(){var e="\n        console.log('yeah nothing');\n      ",t="somefile.ts",r=template_1.inlineTemplate(e,t);expect(r).toEqual(e)})}),describe("updateTemplate",function(){it("should load and replace html file content",function(){var e={"path/to/dir":{"some-file.html":"<div>hello</div>","some-file.scss":"body { color: red; }","some-file.ts":'@Component({templateUrl: "some-file.html" })'}};mockFs(e);var t=template_2.getTemplateMatch(e["path/to/dir"]["some-file.ts"]),r=template_1.replaceTemplateUrl(t,"path/to/dir/some-file.html","<div>hello</div>"),n=template_1.updateTemplate("path/to/dir",t);expect(n).toEqual(r),mockFs.restore()}),it("should load null for unfound html file content",function(){var e={"path/to/dir":{"some-file.html":"<div>hello</div>","some-file.scss":"body { color: red; }","some-file.ts":'@Component({templateUrl: "some-file-doesnt-exist.html" })'}};mockFs(e);var t=template_2.getTemplateMatch(e["path/to/dir"]["some-file.ts"]),r=template_1.updateTemplate("path/to/dir",t);expect(r).toEqual(null),mockFs.restore()})}),describe("replaceTemplateUrl",function(){it("should turn the template into one line",function(){var e='\n        Component({\n          templateUrl: "somepage.html"})',t="\n        <div>	\n          this is \"multiline\" 'content'\n        </div>\r\n      ",r="/full/path/to/somepage.html",n=template_2.getTemplateMatch(e),i=template_1.replaceTemplateUrl(n,r,t),o='Component({template:/*ion-inline-start:"/full/path/to/somepage.html"*/\'\\n        <div>	\\n          this is "multiline" \\\'content\\\'\\n        </div>\\n\\n      \'/*ion-inline-end:"/full/path/to/somepage.html"*/})';expect(i).toEqual(o)})}),describe("getTemplateFormat",function(){it("should resolve the path",function(){var e="some/crazy/path/my.html",t=path_1.resolve(e),r=template_2.getTemplateFormat(e,"filibuster");expect(e).not.toEqual(t),expect(r).toEqual('template:/*ion-inline-start:"'+t+"\"*/'filibuster'/*ion-inline-end:\""+t+'"*/')})}),describe("replaceBundleJsTemplate",function(){it("should replace already inlined template with new content",function(){var e="c:\\path/tosome/crazy:thing.html;",t="some old content",r=template_2.getTemplateFormat(e,t),n="\n        @Component({\n          selector: 'yo-div',\n          /*blah*/"+r+"/*derp*/\n        })\n        @Component({\n          selector: 'yo-div2',\n          /*222*/"+r+"/*2222*/\n        })\n      ",i="some new content",o=template_2.replaceExistingJsTemplate(n,i,e);expect(o.indexOf(i)).toBeGreaterThan(-1),expect(o.indexOf(i)).toBeGreaterThan(-1)})}),describe("COMPONENT_REGEX match",function(){it("should get Component with template url and selector above",function(){var e="\n        Component({\n          selector: 'page-home',\n          templateUrl: 'home.html'\n        })\n      ",t=template_2.getTemplateMatch(e);expect(t.templateUrl).toEqual("home.html")}),it("should get Component with template url and selector below",function(){var e="\n        Component({\n          templateUrl: 'home.html',\n          selector: 'page-home\n        })\n      ",t=template_2.getTemplateMatch(e);expect(t.templateUrl).toEqual("home.html")}),it("should get Component with template url, spaces, tabs and new lines",function(){var e='	\n\r\n        Component(\n          {\n\n            templateUrl :\n              	\n\r"c:\\somewindowspath.ts"\n\n          }\n        )\n      ',t=template_2.getTemplateMatch(e);expect(t.templateUrl).toEqual("c:\\somewindowspath.ts")}),it("should get Component with template url and spaces",function(){var e="  Component  (  {  templateUrl  :  `  hi  `  }  )  ",t=template_2.getTemplateMatch(e);expect(t.component).toEqual("Component  (  {  templateUrl  :  `  hi  `  }  )"),expect(t.templateProperty).toEqual("  templateUrl  :  `  hi  `"),expect(t.templateUrl).toEqual("hi")}),it("should get Component with template url and back-ticks",function(){var e="Component({templateUrl:`hi`})",t=template_2.getTemplateMatch(e);expect(t.component).toEqual("Component({templateUrl:`hi`})"),expect(t.templateProperty).toEqual("templateUrl:`hi`"),expect(t.templateUrl).toEqual("hi")}),it("should get Component with template url and double quotes",function(){var e='Component({templateUrl:"hi"})',t=template_2.getTemplateMatch(e);expect(t.component).toEqual('Component({templateUrl:"hi"})'),expect(t.templateProperty).toEqual('templateUrl:"hi"'),expect(t.templateUrl).toEqual("hi")}),it("should get Component with template url and single quotes",function(){var e="Component({templateUrl:'hi'})",t=template_2.getTemplateMatch(e);expect(t.component).toEqual("Component({templateUrl:'hi'})"),expect(t.templateProperty).toEqual("templateUrl:'hi'"),expect(t.templateUrl).toEqual("hi")}),it("should get null for Component without string for templateUrl",function(){var e="Component({templateUrl:someVar})",t=template_2.getTemplateMatch(e);expect(t).toEqual(null)}),it("should get null for Component without templateUrl",function(){var e='Component({template:"hi"})',t=template_2.getTemplateMatch(e);expect(t).toEqual(null)}),it("should get null for Component without brackets",function(){var e="Component()",t=template_2.getTemplateMatch(e);expect(t).toEqual(null)}),it("should get null for Component without parentheses",function(){var e="Component",t=template_2.getTemplateMatch(e);expect(t).toEqual(null)}),it("should get null for Component({})",function(){var e="Component",t=template_2.getTemplateMatch(e);expect(t).toEqual(null)}),it("should get null for no Component",function(){var e="whatever",t=template_2.getTemplateMatch(e);expect(t).toEqual(null)})});var e=logger_1.Logger.error;logger_1.Logger.error=function(){},afterAll(function(){logger_1.Logger.error=e})});