"use strict";function runWorker(e,t,r,n){return new Promise(function(i,o){var a=createWorker(e),s={taskModule:e,taskWorker:t,context:{rootDir:r.rootDir,tmpDir:r.tmpDir,srcDir:r.srcDir,wwwDir:r.wwwDir,wwwIndex:r.wwwIndex,buildDir:r.buildDir,isProd:r.isProd,isWatch:r.isWatch,bundler:r.bundler,inlineTemplates:r.inlineTemplates},workerConfig:n};a.on("message",function(e){e.error?o(new errors_1.BuildError(e.error)):e.reject?o(new errors_1.BuildError(e.reject)):i(e.resolve),killWorker(e.pid)}),a.on("error",function(t){logger_1.Logger.error("worker error, taskModule: "+e+", pid: "+a.pid+", error: "+t)}),a.on("exit",function(t){logger_1.Logger.debug("worker exited, taskModule: "+e+", pid: "+a.pid)}),a.send(s)})}function killWorker(e){for(var t=exports.workers.length-1;t>=0;t--)if(exports.workers[t].worker.pid===e)try{exports.workers[t].worker.kill("SIGKILL")}catch(r){logger_1.Logger.error("killWorker, "+e+": "+r)}finally{delete exports.workers[t].worker,exports.workers.splice(t,1)}}function createWorker(e){for(var t=exports.workers.length-1;t>=0;t--)if(exports.workers[t].task===e)try{exports.workers[t].worker.kill("SIGKILL")}catch(r){logger_1.Logger.debug("createWorker, "+e+" kill('SIGKILL'): "+r)}finally{delete exports.workers[t].worker,exports.workers.splice(t,1)}try{var n=path_1.join(__dirname,"worker-process.js"),i=child_process_1.fork(n,[],{env:{FORCE_COLOR:!0}});return logger_1.Logger.debug("worker created, taskModule: "+e+", pid: "+i.pid),exports.workers.push({task:e,worker:i}),i}catch(r){throw new errors_1.BuildError("unable to create worker-process, task: "+e+": "+r)}}var errors_1=require("./util/errors"),logger_1=require("./logger/logger"),child_process_1=require("child_process"),path_1=require("path");exports.runWorker=runWorker,exports.createWorker=createWorker,exports.workers=[];