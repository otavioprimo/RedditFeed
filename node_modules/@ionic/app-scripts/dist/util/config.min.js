"use strict";function generateContext(e){e||(e={},e.fileCache=new file_cache_1.FileCache),e.rootDir=path_1.resolve(e.rootDir||getConfigValue(e,"--rootDir",null,ENV_VAR_ROOT_DIR,ENV_VAR_ROOT_DIR.toLowerCase(),processCwd)),setProcessEnvVar(ENV_VAR_ROOT_DIR,e.rootDir),e.tmpDir=path_1.resolve(e.tmpDir||getConfigValue(e,"--tmpDir",null,ENV_VAR_TMP_DIR,ENV_VAR_TMP_DIR.toLowerCase(),path_1.join(e.rootDir,TMP_DIR))),setProcessEnvVar(ENV_VAR_TMP_DIR,e.tmpDir),e.srcDir=path_1.resolve(e.srcDir||getConfigValue(e,"--srcDir",null,ENV_VAR_SRC_DIR,ENV_VAR_SRC_DIR.toLowerCase(),path_1.join(e.rootDir,SRC_DIR))),setProcessEnvVar(ENV_VAR_SRC_DIR,e.srcDir),e.wwwDir=path_1.resolve(e.wwwDir||getConfigValue(e,"--wwwDir",null,ENV_VAR_WWW_DIR,ENV_VAR_WWW_DIR.toLowerCase(),path_1.join(e.rootDir,WWW_DIR))),setProcessEnvVar(ENV_VAR_WWW_DIR,e.wwwDir),e.wwwIndex=path_1.join(e.wwwDir,WWW_INDEX_FILENAME),e.buildDir=path_1.resolve(e.buildDir||getConfigValue(e,"--buildDir",null,ENV_VAR_BUILD_DIR,ENV_VAR_BUILD_DIR.toLowerCase(),path_1.join(e.wwwDir,BUILD_DIR))),setProcessEnvVar(ENV_VAR_BUILD_DIR,e.buildDir),setProcessEnvVar(ENV_VAR_APP_SCRIPTS_DIR,path_1.join(__dirname,"..",".."));var t=getConfigValue(e,"--sourceMap",null,ENV_VAR_SOURCE_MAP,ENV_VAR_SOURCE_MAP.toLowerCase(),"eval");return setProcessEnvVar(ENV_VAR_SOURCE_MAP,t),isValidBundler(e.bundler)||(e.bundler=bundlerStrategy(e)),e.isProd=getIsProd(e),setIonicEnvironment(e.isProd),"boolean"!=typeof e.isWatch&&(e.isWatch=hasArg("--watch")),e.inlineTemplates=!0,checkDebugMode(),e}function getIsProd(e){if("boolean"==typeof e.isProd)return e.isProd;if(hasArg("--dev","-d"))return!1;var t=getPackageJsonConfig(e,ENV_VAR_IONIC_DEV.toLowerCase());return"boolean"==typeof t?!t:(t=getProcessEnvVar(ENV_VAR_IONIC_DEV),"boolean"==typeof t?!t:!0)}function getUserConfigFile(e,t,r){if(r)return path_1.resolve(r);var n=getConfigValue(e,t.fullArg,t.shortArg,t.envVar,t.packageConfig,null);return n?path_1.join(e.rootDir,n):null}function fillConfigDefaults(e,t){var r=null;if(e)try{fs_extra_1.statSync(e),r=require(e)}catch(n){"ENOENT"===n.code?console.error('Config file "'+e+'" not found. Using defaults instead.'):(console.error('There was an error in config file "'+e+'". Using defaults instead.'),console.error(n))}var i=require(path_1.join("..","..","config",t));return helpers_1.objectAssign({},i,r)}function bundlerStrategy(e){var t=getArgValue("--rollup","-r");if(t)return exports.BUNDLER_ROLLUP;t=getPackageJsonConfig(e,"ionic_rollup");var r=getPackageJsonConfig(e,"ionic_webpack");if(t&&r){var n=getPackageJsonConfig(e,"ionic_bundler");if(isValidBundler(n))return n}return(t=getProcessEnvVar("ionic_rollup"))?exports.BUNDLER_ROLLUP:(t=getPackageJsonConfig(e,"ionic_rollup"))?exports.BUNDLER_ROLLUP:(t=getArgValue("--bundler",null),isValidBundler(t)?t:(t=getPackageJsonConfig(e,"ionic_bundler"),isValidBundler(t)?t:(t=getProcessEnvVar("ionic_bundler"),isValidBundler(t)?t:exports.BUNDLER_WEBPACK)))}function isValidBundler(e){return e===exports.BUNDLER_ROLLUP||e===exports.BUNDLER_WEBPACK}function getConfigValue(e,t,r,n,i,o){var a=getArgValue(t,r);if(null!==a)return a;var s=getProcessEnvVar(n);if(null!==s)return s;var u=getPackageJsonConfig(e,i);return null!==u?u:o}function getArgValue(e,t){for(var r=2;r<processArgv.length;r++){var n=processArgv[r];if(n===e||t&&n===t){var i=processArgv[r+1];if(void 0!==i&&""!==i)return i}}return null}function hasConfigValue(e,t,r,n,i){if(hasArg(t,r))return!0;var o=getProcessEnvVar(n);if(null!==o)return!0;var a=getPackageJsonConfig(e,n);return null!==a?!0:i}function hasArg(e,t){return void 0===t&&(t=null),!!(processArgv.some(function(t){return t===e})||null!==t&&processArgv.some(function(e){return e===t}))}function replacePathVars(e,t){return t.replace("{{SRC}}",e.srcDir).replace("{{WWW}}",e.wwwDir).replace("{{TMP}}",e.tmpDir).replace("{{ROOT}}",e.rootDir).replace("{{BUILD}}",e.buildDir)}function getNodeBinExecutable(e,t){var r=path_1.join(e.rootDir,"node_modules",".bin",t);try{fs_extra_1.accessSync(r)}catch(n){r=null}return r}function checkDebugMode(){checkedDebug||((hasArg("--debug")||"true"===getProcessEnvVar("ionic_debug_mode"))&&(processEnv.ionic_debug_mode="true"),checkedDebug=!0)}function isDebugMode(){return"true"===processEnv.ionic_debug_mode}function setIonicEnvironment(e){setProcessEnvVar(ENV_VAR_IONIC_ENV,e?ENV_VAR_PROD:ENV_VAR_DEV)}function setProcessArgs(e){processArgv=e}function addArgv(e){processArgv.push(e)}function setProcessEnv(e){processEnv=e}function setProcessEnvVar(e,t){processEnv[e]=t}function getProcessEnvVar(e){var t=processEnv[e];return void 0!==t?"true"===t?!0:"false"===t?!1:t:null}function setCwd(e){processCwd=e}function getPackageJsonConfig(e,t){var r=getAppPackageJsonData(e);if(r&&r.config){var n=r.config[t];if(void 0!==n)return"true"===n?!0:"false"===n?!1:n}return null}function setAppPackageJsonData(e){appPackageJsonData=e}function getAppPackageJsonData(e){if(!appPackageJsonData)try{appPackageJsonData=fs_extra_1.readJSONSync(path_1.join(e.rootDir,"package.json"))}catch(t){}return appPackageJsonData}var fs_extra_1=require("fs-extra"),path_1=require("path"),helpers_1=require("./helpers"),file_cache_1=require("./file-cache");exports.generateContext=generateContext,exports.getIsProd=getIsProd,exports.getUserConfigFile=getUserConfigFile,exports.fillConfigDefaults=fillConfigDefaults,exports.bundlerStrategy=bundlerStrategy,exports.getConfigValue=getConfigValue,exports.hasConfigValue=hasConfigValue,exports.hasArg=hasArg,exports.replacePathVars=replacePathVars,exports.getNodeBinExecutable=getNodeBinExecutable;var checkedDebug=!1;exports.isDebugMode=isDebugMode,exports.setIonicEnvironment=setIonicEnvironment;var processArgv;exports.setProcessArgs=setProcessArgs,setProcessArgs(process.argv),exports.addArgv=addArgv;var processEnv;exports.setProcessEnv=setProcessEnv,setProcessEnv(process.env),exports.setProcessEnvVar=setProcessEnvVar,exports.getProcessEnvVar=getProcessEnvVar;var processCwd;exports.setCwd=setCwd,setCwd(process.cwd()),exports.getPackageJsonConfig=getPackageJsonConfig;var appPackageJsonData=null;exports.setAppPackageJsonData=setAppPackageJsonData;var BUILD_DIR="build",SRC_DIR="src",TMP_DIR=".tmp",WWW_DIR="www",WWW_INDEX_FILENAME="index.html",ENV_VAR_PROD="prod",ENV_VAR_DEV="dev",ENV_VAR_IONIC_ENV="IONIC_ENV",ENV_VAR_IONIC_DEV="IONIC_DEV",ENV_VAR_ROOT_DIR="IONIC_ROOT_DIR",ENV_VAR_TMP_DIR="IONIC_TMP_DIR",ENV_VAR_SRC_DIR="IONIC_SRC_DIR",ENV_VAR_WWW_DIR="IONIC_WWW_DIR",ENV_VAR_BUILD_DIR="IONIC_BUILD_DIR",ENV_VAR_APP_SCRIPTS_DIR="IONIC_APP_SCRIPTS_DIR",ENV_VAR_SOURCE_MAP="IONIC_SOURCE_MAP";exports.BUNDLER_ROLLUP="rollup",exports.BUNDLER_WEBPACK="webpack";