"use strict";function generateRuntimeDiagnosticContent(e,t,r,n){var i=[];i.push('<div class="ion-diagnostic">'),i.push('<div class="ion-diagnostic-masthead">'),i.push('<div class="ion-diagnostic-header">Runtime Error</div>'),r&&(r=r.replace(/inline template:\d+:\d+/g,""),r=r.replace("inline template",""),i.push('<div class="ion-diagnostic-message">'+helpers_1.escapeHtml(r)+"</div>")),i.push("</div>");var o=generateRuntimeStackDiagnostics(e,n);return o.forEach(function(e){i.push(logger_diagnostics_1.generateCodeBlock(e))}),n&&(i.push('<div class="ion-diagnostic-stack-header">Stack</div>'),i.push('<div class="ion-diagnostic-stack">'+helpers_1.escapeHtml(n)+"</div>")),i.push("</div>"),logger_diagnostics_1.getDiagnosticsHtmlContent(t,i.join("\n"))}function generateRuntimeStackDiagnostics(e,t){var r=[];return t&&helpers_1.splitLineBreaks(t).forEach(function(t){try{var n=WEBPACK_FILE_REGEX.exec(t);if(!n)return;var i=n[1].split("?");if(2!==i.length)return;var o=i[1].split(":");if(3!==o.length)return;var s=i[0];if(s.indexOf("~")>-1)return;var a=parseInt(o[1],10),u=parseInt(o[2],10),c={level:"error",language:"typescript",type:"runtime",header:"",code:"runtime",messageText:"",absFileName:path_1.resolve(e,s),relFileName:path_1.normalize(s),lines:[]},l=fs_1.readFileSync(c.absFileName,"utf8"),p=helpers_1.splitLineBreaks(l);if(!p.length||a>=p.length)return;var f=p;try{f=helpers_1.splitLineBreaks(highlight_1.highlight(c.language,l,!0).value)}catch(h){}var d={lineIndex:a-1,lineNumber:a,text:p[a-1],html:f[a-1],errorCharStart:u+1,errorLength:1};if(-1===d.html.indexOf('class="hljs'))try{d.html=highlight_1.highlight(c.language,d.text,!0).value}catch(h){}if(c.lines.push(d),d.lineIndex>0){var v={lineIndex:d.lineIndex-1,lineNumber:d.lineNumber-1,text:p[d.lineIndex-1],html:f[d.lineIndex-1],errorCharStart:-1,errorLength:-1};if(-1===v.html.indexOf('class="hljs'))try{v.html=highlight_1.highlight(c.language,v.text,!0).value}catch(h){}c.lines.unshift(v)}if(d.lineIndex<p.length){var m={lineIndex:d.lineIndex+1,lineNumber:d.lineNumber+1,text:p[d.lineIndex+1],html:f[d.lineIndex+1],errorCharStart:-1,errorLength:-1};if(-1===m.html.indexOf('class="hljs'))try{m.html=highlight_1.highlight(c.language,m.text,!0).value}catch(h){}c.lines.push(m)}r.push(c)}catch(h){}}),r}var helpers_1=require("../util/helpers"),logger_diagnostics_1=require("./logger-diagnostics"),highlight_1=require("../highlight/highlight"),fs_1=require("fs"),path_1=require("path");exports.generateRuntimeDiagnosticContent=generateRuntimeDiagnosticContent,exports.generateRuntimeStackDiagnostics=generateRuntimeStackDiagnostics;var WEBPACK_FILE_REGEX=/\(webpack:\/\/\/(.*?)\)/;