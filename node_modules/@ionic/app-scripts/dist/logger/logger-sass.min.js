"use strict";function runSassDiagnostics(e,t){if(!t)return[];var r={level:"error",type:"sass",language:"scss",header:"sass error",code:t.status&&t.status.toString(),relFileName:null,absFileName:null,messageText:t.message,lines:[]};if(t.file&&(r.absFileName=t.file,r.relFileName=logger_1.Logger.formatFileName(e.rootDir,r.absFileName),r.header=logger_1.Logger.formatHeader("sass",r.absFileName,e.rootDir,t.line),t.line>-1))try{var n=fs_1.readFileSync(r.absFileName,"utf8"),i=helpers_1.splitLineBreaks(n),o=i;try{o=helpers_1.splitLineBreaks(highlight_1.highlight(r.language,n,!0).value)}catch(s){}var a={lineIndex:t.line-1,lineNumber:t.line,text:i[t.line-1],html:o[t.line-1],errorCharStart:t.column,errorLength:0};if(-1===a.html.indexOf('class="hljs'))try{a.html=highlight_1.highlight(r.language,a.text,!0).value}catch(s){}for(var u=a.errorCharStart;u>=0&&!(STOP_CHARS.indexOf(a.text.charAt(u))>-1);u--)a.errorCharStart=u;for(var u=a.errorCharStart;u<=a.text.length&&!(STOP_CHARS.indexOf(a.text.charAt(u))>-1);u++)a.errorLength++;if(0===a.errorLength&&a.errorCharStart>0&&(a.errorLength=1,a.errorCharStart--),r.lines.push(a),a.lineIndex>0){var c={lineIndex:a.lineIndex-1,lineNumber:a.lineNumber-1,text:i[a.lineIndex-1],html:o[a.lineIndex-1],errorCharStart:-1,errorLength:-1};if(-1===c.html.indexOf('class="hljs'))try{c.html=highlight_1.highlight(r.language,c.text,!0).value}catch(s){}r.lines.unshift(c)}if(a.lineIndex+1<i.length){var l={lineIndex:a.lineIndex+1,lineNumber:a.lineNumber+1,text:i[a.lineIndex+1],html:o[a.lineIndex+1],errorCharStart:-1,errorLength:-1};if(-1===l.html.indexOf('class="hljs'))try{l.html=highlight_1.highlight(r.language,l.text,!0).value}catch(s){}r.lines.push(l)}}catch(s){logger_1.Logger.debug("sass loadDiagnostic, "+s)}return[r]}var highlight_1=require("../highlight/highlight"),logger_1=require("./logger"),fs_1=require("fs"),helpers_1=require("../util/helpers");exports.runSassDiagnostics=runSassDiagnostics;var STOP_CHARS=["","\n","\r","	"," ",":",";",",","{","}",".","#","@","!","[","]","(",")","&","+","~","^","*","$"];