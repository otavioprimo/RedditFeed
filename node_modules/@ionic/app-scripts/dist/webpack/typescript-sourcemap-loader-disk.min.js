"use strict";function loadBetterSourceMap(e,t,r,n){var i=e+".map",o=helpers_1.changeExtension(e,".ts"),a=null,s=null,u=helpers_1.readFileAsync(i);u.then(function(e){a=e});var l=helpers_1.readFileAsync(o);l.then(function(e){s=e});var c=[];c.push(u),c.push(l),Promise.all(c).then(function(){if(a&&a.length){if(s&&s.length)return JSON.parse(a);throw new Error("Failed to read typescript file")}throw new Error("Failed to read sourcemap file")}).then(function(n){n.sourcesContent&&0!==n.sourcesContent.length||(logger_1.Logger.debug("loadBetterSourceMap: Assigning Typescript content to source map for "+e),n.sourcesContent=[s]),t(null,r,n)})["catch"](function(i){logger_1.Logger.debug("Failed to generate typescript sourcemaps for "+e+": "+i.message),t(null,r,n)})}var logger_1=require("../logger/logger"),helpers_1=require("../util/helpers");module.exports=function(e,t){this.cacheable();var r=this.async();this.resourcePath.indexOf("node_modules")>-1?r(null,e,t):loadBetterSourceMap(this.resourcePath,r,e,t)};