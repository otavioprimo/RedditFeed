"use strict";function build(e){e=config_1.generateContext(e);var t=new logger_1.Logger("build "+(e.isProd?"prod":"dev"));return buildWorker(e).then(function(){t.finish()})["catch"](function(e){throw t.fail(e)})}function buildWorker(e){return e.isProd?buildProd(e):buildDev(e)}function buildProd(e){clean_1.clean(e),buildId++;var t=copy_1.copy(e);return ngc_1.ngc(e).then(function(){return bundle_1.bundle(e)}).then(function(){var t=minify_1.minifyJs(e),r=sass_1.sass(e).then(function(){return minify_1.minifyCss(e)});return Promise.all([t,r])}).then(function(){return lint_1.lint(e),Promise.all([t])})["catch"](function(e){throw new errors_1.BuildError(e)})}function buildDev(e){clean_1.clean(e),buildId++;var t=copy_1.copy(e);return transpile_1.transpile(e).then(function(){return bundle_1.bundle(e)}).then(function(){return Promise.all([sass_1.sass(e),t])}).then(function(){return lint_1.lint(e),Promise.resolve()})["catch"](function(e){throw new errors_1.BuildError(e)})}function buildUpdate(e,t,r){return new Promise(function(n){function s(o){u.then(function(){var s={buildId:buildId,reloadApp:o.requiresAppReload};events_1.emit(events_1.EventType.BuildUpdateCompleted,s),o.requiresAppReload||events_1.emit(events_1.EventType.FileChange,o.changedFile),t.endsWith(".ts")&&lint_1.lintUpdate(e,t,r),i.finish("green",!0),logger_1.Logger.newLine(),n()})}var i=new logger_1.Logger("build");buildId++;var o={buildId:buildId,reloadApp:!1};events_1.emit(events_1.EventType.BuildUpdateStarted,o);var a=buildUpdateTasks(e,t,r),u=buildUpdateParallelTasks(e,t,r);a.then(s)["catch"](function(){s({requiresAppReload:!1,changedFile:t})})})}function buildUpdateTasks(e,t,r){var n={requiresAppReload:!1,changedFile:t};return Promise.resolve().then(function(){return r.templateState===interfaces_1.BuildState.RequiresUpdate?(n.requiresAppReload=!0,template_1.templateUpdate(e,t,r)):Promise.resolve()}).then(function(){return r.transpileState===interfaces_1.BuildState.RequiresUpdate?(n.requiresAppReload=!0,transpile_1.transpileUpdate(e,t,r)):r.transpileState===interfaces_1.BuildState.RequiresBuild?(n.requiresAppReload=!0,transpile_1.transpile(r)):Promise.resolve()}).then(function(){return r.bundleState===interfaces_1.BuildState.RequiresUpdate?(n.requiresAppReload=!0,bundle_1.bundleUpdate(e,t,r)):r.bundleState===interfaces_1.BuildState.RequiresBuild?(n.requiresAppReload=!0,bundle_1.bundle(r)):Promise.resolve()}).then(function(){return r.sassState===interfaces_1.BuildState.RequiresUpdate?sass_1.sassUpdate(e,t,r).then(function(e){n.changedFile=e}):r.sassState===interfaces_1.BuildState.RequiresBuild?sass_1.sass(r).then(function(e){n.changedFile=e}):Promise.resolve()}).then(function(){return n})}function buildUpdateParallelTasks(e,t,r){var n=[];return r.transpileState===interfaces_1.BuildState.RequiresUpdate&&n.push(transpile_1.transpileDiagnosticsOnly(r)),Promise.all(n)}var interfaces_1=require("./util/interfaces"),errors_1=require("./util/errors"),bundle_1=require("./bundle"),clean_1=require("./clean"),copy_1=require("./copy"),events_1=require("./util/events"),config_1=require("./util/config"),lint_1=require("./lint"),logger_1=require("./logger/logger"),minify_1=require("./minify"),ngc_1=require("./ngc"),sass_1=require("./sass"),template_1=require("./template"),transpile_1=require("./transpile");exports.build=build,exports.buildUpdate=buildUpdate;var buildId=0;