"use strict";function readShebang(e){var t,r,n,i;if(shebangCache.has(e))return shebangCache.get(e);t=new Buffer(150);try{r=fs.openSync(e,"r"),fs.readSync(r,t,0,150,0),fs.closeSync(r)}catch(a){}return n=t.toString().trim().match(/#!(.+)/i),n&&(i=n[1].replace(/\/usr\/bin\/env\s+/i,"")),shebangCache.set(e,i),i}function escapeArg(e,t){return e=""+e,t?(e=e.replace(/(\\*)"/g,'$1$1\\"'),e=e.replace(/(\\*)$/,"$1$1"),e='"'+e+'"'):e=e.replace(/([\(\)%!\^<>&|;,"'\s])/g,"^$1"),e}function escapeCommand(e){return/^[a-z0-9_-]+$/i.test(e)?e:escapeArg(e,!0)}function requiresShell(e){return!/\.(?:com|exe)$/i.test(e)}function parse(e,t,r){var n,i,a,o,s;return t&&!Array.isArray(t)&&(r=t,t=null),t=t?t.slice(0):[],r=r||{},o=e,isWin&&(a=resolveCommand(e),a=a||resolveCommand(e,!0),n=a&&readShebang(a),s=r.shell||hasBrokenSpawn,n?(t.unshift(a),e=n,s=s||requiresShell(resolveCommand(n)||resolveCommand(n,!0))):s=s||requiresShell(a),s&&(i="echo"!==e,e=escapeCommand(e),t=t.map(function(e){return escapeArg(e,i)}),t=["/s","/c",'"'+e+(t.length?" "+t.join(" "):"")+'"'],e=process.env.comspec||"cmd.exe",r.windowsVerbatimArguments=!0)),{command:e,args:t,options:r,file:a,original:o}}var fs=require("fs"),LRU=require("lru-cache"),resolveCommand=require("./resolveCommand"),hasBrokenSpawn=require("./hasBrokenSpawn"),isWin="win32"===process.platform,shebangCache=new LRU({max:50,maxAge:3e4});module.exports=parse;