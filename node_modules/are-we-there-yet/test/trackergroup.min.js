"use strict";var test=require("tap").test,TrackerGroup=require("../index.js").TrackerGroup,testEvent=require("./lib/test-event.js");test("TrackerGroup",function(e){function o(o,a,u){e.is(o,null,"finishEmpty: on change event fired"),e.is(a,t,"finishEmpty: on change emits the correct name"),e.is(u,1,"finishEmpty: passed through completion was correct"),e.is(r.completed(),1,"finishEmpty: Finishing an empty group actually finishes it"),r=new TrackerGroup(t),n=r.newItem("a",10,1),i=r.newItem("b",10,1),e.is(r.completed(),0,"Initially empty"),testEvent(r,"change",s),n.completeWork(5)}function s(t,n,i){e.is(t,null,"on change event fired"),e.is(n,"a","on change emits the correct name"),e.is(i,.25,"Complete half of one is a quarter overall"),e.is(r.completed(),.25,"Complete half of one is a quarter overall"),testEvent(r,"change",a),r.finish()}function a(o,s,a){e.is(o,null,"finishAll: on change event fired"),e.is(s,t,"finishAll: on change emits the correct name"),e.is(a,1,"Finishing everything "),e.is(r.completed(),1,"Finishing everything "),r=new TrackerGroup(t),n=r.newItem("a",10,2),i=r.newItem("b",10,1),e.is(r.completed(),0,"weighted: Initially empty"),testEvent(r,"change",u),n.completeWork(5)}function u(t,n,i){e.is(t,null,"weighted: on change event fired"),e.is(n,"a","weighted: on change emits the correct name"),e.is(Math.floor(100*i),33,"weighted: Complete half of double weighted"),e.is(Math.floor(100*r.completed()),33,"weighted: Complete half of double weighted"),testEvent(r,"change",l),r.finish()}function l(o,s,a){e.is(o,null,"weightedFinishAll: on change event fired"),e.is(s,t,"weightedFinishAll: on change emits the correct name"),e.is(a,1,"weightedFinishaAll: Finishing everything "),e.is(r.completed(),1,"weightedFinishaAll: Finishing everything "),r=new TrackerGroup(t),n=r.newGroup("a",10),i=r.newGroup("b",10);var u=n.newItem("a.1",10);u.completeWork(5),e.is(r.completed(),.25,"nested: Initially quarter done"),testEvent(r,"change",c),i.finish()}function c(t,n,i){e.is(t,null,"nestedComplete: on change event fired"),e.is(n,"b","nestedComplete: on change emits the correct name"),e.is(i,.75,"nestedComplete: Finishing everything "),e.is(r.completed(),.75,"nestedComplete: Finishing everything "),e.end()}var t="test",r=new TrackerGroup(t);e.is(r.completed(),0,"Nothing todo is 0 completion"),testEvent(r,"change",o),r.finish();var n,i}),test("cycles",function(e){function n(t,r){try{t.addUnit(r),e.fail(r.name)}catch(n){console.log(n),e.pass(r.name)}}var t=new TrackerGroup("top");n(t,t);var r=t.newGroup("layer1");n(r,t),e.end()});