function UrlsProcessor(e,t,r){this.urls=new EscapeStore("URL"),this.context=e,this.saveWaypoints=t,this.keepUrlQuotes=r}function normalize(e,t){return e=e.replace(/^url/gi,"url").replace(/\\?\n|\\?\r\n/g,"").replace(/(\s{2,}|\s)/g," ").replace(/^url\((['"])? /,"url($1").replace(/ (['"])?\)$/,"$1)"),/url\(".*'.*"\)/.test(e)||/url\('.*".*'\)/.test(e)?e:(t||/^['"].+['"]$/.test(e)||/url\(.*[\s\(\)].*\)/.test(e)||/url\(['"]data:[^;]+;charset/.test(e)||(e=e.replace(/["']/g,"")),e)}var EscapeStore=require("./escape-store"),reduceUrls=require("../urls/reduce"),lineBreak=require("os").EOL;UrlsProcessor.prototype.escape=function(e){var t,r,n,i=this.saveWaypoints,a=this;return reduceUrls(e,this.context,function(e,o){i&&(t=e.split(lineBreak).length-1,r=e.lastIndexOf(lineBreak),n=r>0?e.substring(r+lineBreak.length).length:e.length);var s=a.urls.store(e,i?[t,n]:null);o.push(s)})},UrlsProcessor.prototype.restore=function(e){for(var t=[],r=0;r<e.length;){var n=this.urls.nextMatch(e,r);if(n.start<0)break;t.push(e.substring(r,n.start));var i=normalize(this.urls.restore(n.match),this.keepUrlQuotes);t.push(i),r=n.end}return t.length>0?t.join("")+e.substring(r,e.length):e},module.exports=UrlsProcessor;