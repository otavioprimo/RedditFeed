function selectorName(e){return e[0]}function noop(){}function withoutComments(e,t,r,n){for(var i=r?/^__ESCAPED_COMMENT_/:/__ESCAPED_COMMENT_/,a=r?n.track:noop;i.test(e);){var o=e.indexOf("__"),s=e.indexOf("__",o+1)+2,u=e.substring(o,s);e=e.substring(0,o)+e.substring(s),a(u),t.push(u)}return e}function withoutHeadingComments(e,t,r){return withoutComments(e,t,!0,r)}function withoutInnerComments(e,t,r){return withoutComments(e,t,!1,r)}function trackComments(e,t,r){for(var n=0,i=e.length;i>n;n++)r.track(e[n]),t.push(e[n])}function extractProperties(e,t,r){var n=[],i=[],a=/[ ,\/]/;if("string"!=typeof e)return[];e.indexOf(")")>-1&&(e=e.replace(/\)([^\s_;:,\)])/g,r.sourceMap?") __ESCAPED_COMMENT_CLEAN_CSS(0,-1)__ $1":") $1")),e.indexOf("ESCAPED_URL_CLEAN_CSS")>-1&&(e=e.replace(/(ESCAPED_URL_CLEAN_CSS[^_]+?__)/g,r.sourceMap?"$1 __ESCAPED_COMMENT_CLEAN_CSS(0,-1)__ ":"$1 "));for(var o=split(e,";",!1,"{","}"),s=0,u=o.length;u>s;s++){var l=o[s],c=l.indexOf(":"),f="@"==l.trim()[0];if(f)r.track(l),n.push([AT_RULE,l.trim()]);else if(-1!=c)if(l.indexOf("{")>0&&l.indexOf("{")<c)r.track(l);else{var p=[],h=l.substring(0,c);i=[],h.indexOf("__ESCAPED_COMMENT")>-1&&(h=withoutHeadingComments(h,n,r)),h.indexOf("__ESCAPED_COMMENT")>-1&&(h=withoutInnerComments(h,i,r)),p.push([h.trim()].concat(r.track(h,!0))),r.track(":"),trackComments(i,n,r);var d=l.indexOf("{"),v=0===h.trim().indexOf("--");if(v&&d>0){var m=l.substring(c+1,d+1),g=l.substring(l.indexOf("}")),y=l.substring(d+1,l.length-g.length);r.track(m),p.push(extractProperties(y,t,r)),n.push(p),r.track(g),r.track(u-1>s?";":"")}else{var b=split(l.substring(c+1),a,!0);if(1!=b.length||""!==b[0]){for(var _=0,w=b.length;w>_;_++){var x=b[_],E=x.trim();if(0!==E.length){var S=E[E.length-1],k=E.length>1&&(S==COMMA||S==FORWARD_SLASH);if(k&&(E=E.substring(0,E.length-1)),E.indexOf("__ESCAPED_COMMENT_CLEAN_CSS(0,-")>-1)r.track(E);else if(i=[],E.indexOf("__ESCAPED_COMMENT")>-1&&(E=withoutHeadingComments(E,n,r)),E.indexOf("__ESCAPED_COMMENT")>-1&&(E=withoutInnerComments(E,i,r)),0!==E.length){var C=p.length-1;IMPORTANT_WORD_MATCH.test(E)&&"!"==p[C][0]?(r.track(E),p[C-1][0]+=IMPORTANT_TOKEN,p.pop()):IMPORTANT_TOKEN_MATCH.test(E)||IMPORTANT_WORD_MATCH.test(E)&&"!"==p[C][0][p[C][0].length-1]?(r.track(E),p[C][0]+=E):(p.push([E].concat(r.track(x,!0))),trackComments(i,n,r),k&&(p.push([S]),r.track(S)))}else trackComments(i,n,r)}}u-1>s&&r.track(";"),n.push(p)}else r.warnings.push("Empty property '"+h+"' inside '"+t.filter(selectorName).join(",")+"' selector. Ignoring.")}}else r.track(l),l.indexOf("__ESCAPED_COMMENT_SPECIAL")>-1&&n.push(l.trim())}return n}var split=require("../utils/split"),COMMA=",",FORWARD_SLASH="/",AT_RULE="at-rule",IMPORTANT_WORD="important",IMPORTANT_TOKEN="!"+IMPORTANT_WORD,IMPORTANT_WORD_MATCH=new RegExp("^"+IMPORTANT_WORD+"$","i"),IMPORTANT_TOKEN_MATCH=new RegExp("^"+IMPORTANT_TOKEN+"$","i");module.exports=extractProperties;