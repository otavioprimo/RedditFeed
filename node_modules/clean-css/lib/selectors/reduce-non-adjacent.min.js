function reduceNonAdjacent(e,t,r){for(var n={},i=[],a=e.length-1;a>=0;a--){var o=e[a];if("selector"==o[0]&&0!==o[2].length)for(var s=stringifySelectors(o[1]),u=o[1].length>1&&!isSpecial(t,s),l=t.sourceMap?wrappedSelectorsFrom(o[1]):o[1],c=u?[s].concat(l):[s],f=0,p=c.length;p>f;f++){var h=c[f];n[h]?i.push(h):n[h]=[],n[h].push({where:a,list:l,isPartial:u&&f>0,isComplex:u&&0===f})}}reduceSimpleNonAdjacentCases(e,i,n,t,r),reduceComplexNonAdjacentCases(e,n,t,r)}function wrappedSelectorsFrom(e){for(var t=[],r=0;r<e.length;r++)t.push([e[r][0]]);return t}function reduceSimpleNonAdjacentCases(e,t,r,n,i){function a(e,t){return c[e].isPartial&&0===t.length}function o(e,t,r,n){c[r-n-1].isPartial||(e[2]=t)}for(var s=0,u=t.length;u>s;s++){var l=t[s],c=r[l];reduceSelector(e,l,c,{filterOut:a,callback:o},n,i)}}function reduceComplexNonAdjacentCases(e,t,r,n){function a(e){return i.data[e].where<i.intoPosition}function o(e,t,r,n){0===n&&i.reducedBodies.push(t)}var i={};e:for(var s in t){var u=t[s];if(u[0].isComplex){var l=u[u.length-1].where,c=e[l],f=[],p=isSpecial(r,s)?[s]:u[0].list;i.intoPosition=l,i.reducedBodies=f;for(var h=0,d=p.length;d>h;h++){var v=p[h],m=t[v];if(m.length<2)continue e;if(i.data=m,reduceSelector(e,v,m,{filterOut:a,callback:o},r,n),stringifyBody(f[f.length-1])!=stringifyBody(f[0]))continue e}c[2]=f[0]}}}function reduceSelector(e,t,r,n,i,a){for(var o=[],s=[],u=[],l=[],c=r.length-1,f=0;c>=0;c--)if(!n.filterOut(c,o)){var p=r[c].where,h=e[p],d=cloneArray(h[2]);o=o.concat(d),s.push(d),l.push(p)}for(c=0,f=s.length;f>c;c++)s[c].length>0&&u.push((u[c-1]||0)+s[c].length);optimizeProperties(t,o,u,!1,i,a);for(var v=l.length,m=o.length-1,g=v-1;g>=0;)if((0===g||o[m]&&s[g].indexOf(o[m])>-1)&&m>-1)m--;else{var y=o.splice(m+1);n.callback(e[l[g]],y,v,g),g--}}var optimizeProperties=require("../properties/optimizer"),stringifyBody=require("../stringifier/one-time").body,stringifySelectors=require("../stringifier/one-time").selectors,isSpecial=require("./is-special"),cloneArray=require("../utils/clone-array");module.exports=reduceNonAdjacent;