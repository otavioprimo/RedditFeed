function _colorFilter(e){return function(t){return"invert"==t[0]||e.isValidColor(t[0])}}function _styleFilter(e){return function(t){return"inherit"!=t[0]&&e.isValidStyle(t[0])&&!e.isValidColorValue(t[0])}}function _wrapDefault(e,t,r){var n=r[e];return wrapSingle(n.doubleValues&&2==n.defaultValue.length?[[e,t.important],[n.defaultValue[0]],[n.defaultValue[1]]]:n.doubleValues&&1==n.defaultValue.length?[[e,t.important],[n.defaultValue[0]]]:[[e,t.important],[n.defaultValue]])}function _widthFilter(e){return function(t){return"inherit"!=t[0]&&e.isValidWidth(t[0])&&!e.isValidStyleKeyword(t[0])&&!e.isValidColorValue(t[0])}}function background(e,t,r){var n=_wrapDefault("background-image",e,t),i=_wrapDefault("background-position",e,t),a=_wrapDefault("background-size",e,t),s=_wrapDefault("background-repeat",e,t),o=_wrapDefault("background-attachment",e,t),u=_wrapDefault("background-origin",e,t),l=_wrapDefault("background-clip",e,t),c=_wrapDefault("background-color",e,t),f=[n,i,a,s,o,u,l,c],p=e.value,h=!1,d=!1,v=!1,m=!1;if(1==e.value.length&&"inherit"==e.value[0][0])return c.value=n.value=s.value=i.value=a.value=u.value=l.value=e.value,f;for(var g=p.length-1;g>=0;g--){var y=p[g];if(r.isValidBackgroundAttachment(y[0]))o.value=[y];else if(r.isValidBackgroundBox(y[0]))d?(u.value=[y],v=!0):(l.value=[y],d=!0);else if(r.isValidBackgroundRepeat(y[0]))m?s.value.unshift(y):(s.value=[y],m=!0);else if(r.isValidBackgroundPositionPart(y[0])||r.isValidBackgroundSizePart(y[0]))if(g>0){var b=p[g-1];if(b[0].indexOf("/")>0){var _=split(b[0],"/");a.value=[[_.pop()].concat(b.slice(1)),y],p[g-1]=[_.pop()].concat(b.slice(1))}else g>1&&"/"==p[g-2][0]?(a.value=[b,y],g-=2):"/"==b[0]?a.value=[y]:(h||(i.value=[]),i.value.unshift(y),h=!0)}else h||(i.value=[]),i.value.unshift(y),h=!0;else if(r.isValidBackgroundPositionAndSize(y[0])){var w=split(y[0],"/");a.value=[[w.pop()].concat(y.slice(1))],i.value=[[w.pop()].concat(y.slice(1))]}else c.value[0][0]!=t[c.name].defaultValue&&"none"!=c.value[0][0]||!r.isValidColor(y[0])?(r.isValidUrl(y[0])||r.isValidFunction(y[0]))&&(n.value=[y]):c.value=[y]}return d&&!v&&(u.value=l.value.slice(0)),f}function borderRadius(e,t){for(var r=e.value,n=-1,i=0,a=r.length;a>i;i++)if("/"==r[i][0]){n=i;break}if(0===n||n===r.length-1)throw new InvalidPropertyError("Invalid border-radius value.");var s=_wrapDefault(e.name,e,t);s.value=n>-1?r.slice(0,n):r.slice(0),s.components=fourValues(s,t);var o=_wrapDefault(e.name,e,t);o.value=n>-1?r.slice(n+1):r.slice(0),o.components=fourValues(o,t);for(var u=0;4>u;u++)s.components[u].multiplex=!0,s.components[u].value=s.components[u].value.concat(o.components[u].value);return s.components}function fourValues(e,t){var r=t[e.name].components,n=[],i=e.value;if(i.length<1)return[];i.length<2&&(i[1]=i[0].slice(0)),i.length<3&&(i[2]=i[0].slice(0)),i.length<4&&(i[3]=i[1].slice(0));for(var a=r.length-1;a>=0;a--){var s=wrapSingle([[r[a],e.important]]);s.value=[i[a]],n.unshift(s)}return n}function multiplex(e){return function(t,r,n){var s,o,u,l,i=[],a=t.value;for(s=0,u=a.length;u>s;s++)","==a[s][0]&&i.push(s);if(0===i.length)return e(t,r,n);var c=[];for(s=0,u=i.length;u>=s;s++){var f=0===s?0:i[s-1]+1,p=u>s?i[s]:a.length,h=_wrapDefault(t.name,t,r);h.value=a.slice(f,p),c.push(e(h,r,n))}var d=c[0];for(s=0,u=d.length;u>s;s++)for(d[s].multiplex=!0,o=1,l=c.length;l>o;o++)d[s].value.push([MULTIPLEX_SEPARATOR]),Array.prototype.push.apply(d[s].value,c[o][s].value);return d}}function listStyle(e,t,r){var n=_wrapDefault("list-style-type",e,t),i=_wrapDefault("list-style-position",e,t),a=_wrapDefault("list-style-image",e,t),s=[n,i,a];if(1==e.value.length&&"inherit"==e.value[0][0])return n.value=i.value=a.value=[e.value[0]],s;var o=e.value.slice(0),u=o.length,l=0;for(l=0,u=o.length;u>l;l++)if(r.isValidUrl(o[l][0])||"0"==o[l][0]){a.value=[o[l]],o.splice(l,1);break}for(l=0,u=o.length;u>l;l++)if(r.isValidListStyleType(o[l][0])){n.value=[o[l]],o.splice(l,1);break}return o.length>0&&r.isValidListStylePosition(o[0][0])&&(i.value=[o[0]]),s}function widthStyleColor(e,t,r){for(var a,s,o,n=t[e.name],i=[_wrapDefault(n.components[0],e,t),_wrapDefault(n.components[1],e,t),_wrapDefault(n.components[2],e,t)],u=0;3>u;u++){var l=i[u];l.name.indexOf("color")>0?a=l:l.name.indexOf("style")>0?s=l:o=l}if(1==e.value.length&&"inherit"==e.value[0][0]||3==e.value.length&&"inherit"==e.value[0][0]&&"inherit"==e.value[1][0]&&"inherit"==e.value[2][0])return a.value=s.value=o.value=[e.value[0]],i;var f,p,c=e.value.slice(0);return c.length>0&&(p=c.filter(_widthFilter(r)),f=p.length>1&&("none"==p[0][0]||"auto"==p[0][0])?p[1]:p[0],f&&(o.value=[f],c.splice(c.indexOf(f),1))),c.length>0&&(f=c.filter(_styleFilter(r))[0],f&&(s.value=[f],c.splice(c.indexOf(f),1))),c.length>0&&(f=c.filter(_colorFilter(r))[0],f&&(a.value=[f],c.splice(c.indexOf(f),1))),i}var wrapSingle=require("./wrap-for-optimizing").single,InvalidPropertyError=require("./invalid-property-error"),split=require("../utils/split"),MULTIPLEX_SEPARATOR=",";module.exports={background:background,border:widthStyleColor,borderRadius:borderRadius,fourValues:fourValues,listStyle:listStyle,multiplex:multiplex,outline:widthStyleColor};