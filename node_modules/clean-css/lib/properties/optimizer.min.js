function _optimize(e,t,r,n){function u(e){return t===!1||t===!0?t:t.indexOf(e)>-1}function l(t){var r=e[t-1],n=e[t];return stringifyProperty(r.all,r.position)==stringifyProperty(n.all,n.position)}var o,s,i={},a=null;e:for(var c=0,f=e.length;f>c;c++){var p=e[c],h=!("-ms-filter"!=p.name&&"filter"!=p.name||"background"!=a&&"background-image"!=a)?a:p.name,d=p.important,v=p.hack;if(!p.unused)if(c>0&&o&&h==a&&d==o.important&&v==o.hack&&l(c)&&!o.unused)p.unused=!0;else{if(h in i&&(r&&h!=a||u(c))){var m=i[h],g=compactable[h]&&compactable[h].canOverride,y=!1;for(s=m.length-1;s>=0;s--){var b=e[m[s]],_=b.name!=h,w=b.important,x=b.hack;if(!b.unused&&(!_||!w)&&(w||!(x&&!v||!x&&v))&&(!w||"star"!=v&&"underscore"!=v)&&(x||v||_||!g||g(b,p,n))){if(w&&!d||w&&v){p.unused=!0,o=p;continue e}y=!0,b.unused=!0}}if(y){c=-1,o=null,a=null,i={};continue}}else{i[h]=i[h]||[],i[h].push(c);var E=shorthands[h];if(E)for(s=E.length-1;s>=0;s--){var S=E[s];i[S]=i[S]||[],i[S].push(c)}}a=h,o=p}}}function optimize(e,t,r,n,i,a){var o=a.validator,s=a.warnings,u=wrapForOptimizing(t);populateComponents(u,o,s),_optimize(u,r,i.aggressiveMerging,o);for(var l=0,c=u.length;c>l;l++){var f=u[l];f.variable&&f.block&&optimize(e,f.value[0],r,n,i,a)}n&&i.shorthandCompacting&&(compactOverrides(u,i.compatibility,o),compactShorthands(u,i.sourceMap,o)),restoreFromOptimizing(u),removeUnused(u)}var compactable=require("./compactable"),wrapForOptimizing=require("./wrap-for-optimizing").all,populateComponents=require("./populate-components"),compactOverrides=require("./override-compactor"),compactShorthands=require("./shorthand-compactor"),removeUnused=require("./remove-unused"),restoreFromOptimizing=require("./restore-from-optimizing"),stringifyProperty=require("../stringifier/one-time").property,shorthands={"animation-delay":["animation"],"animation-direction":["animation"],"animation-duration":["animation"],"animation-fill-mode":["animation"],"animation-iteration-count":["animation"],"animation-name":["animation"],"animation-play-state":["animation"],"animation-timing-function":["animation"],"-moz-animation-delay":["-moz-animation"],"-moz-animation-direction":["-moz-animation"],"-moz-animation-duration":["-moz-animation"],"-moz-animation-fill-mode":["-moz-animation"],"-moz-animation-iteration-count":["-moz-animation"],"-moz-animation-name":["-moz-animation"],"-moz-animation-play-state":["-moz-animation"],"-moz-animation-timing-function":["-moz-animation"],"-o-animation-delay":["-o-animation"],"-o-animation-direction":["-o-animation"],"-o-animation-duration":["-o-animation"],"-o-animation-fill-mode":["-o-animation"],"-o-animation-iteration-count":["-o-animation"],"-o-animation-name":["-o-animation"],"-o-animation-play-state":["-o-animation"],"-o-animation-timing-function":["-o-animation"],"-webkit-animation-delay":["-webkit-animation"],"-webkit-animation-direction":["-webkit-animation"],"-webkit-animation-duration":["-webkit-animation"],"-webkit-animation-fill-mode":["-webkit-animation"],"-webkit-animation-iteration-count":["-webkit-animation"],"-webkit-animation-name":["-webkit-animation"],"-webkit-animation-play-state":["-webkit-animation"],"-webkit-animation-timing-function":["-webkit-animation"],"border-color":["border"],"border-style":["border"],"border-width":["border"],"border-bottom":["border"],"border-bottom-color":["border-bottom","border-color","border"],"border-bottom-style":["border-bottom","border-style","border"],"border-bottom-width":["border-bottom","border-width","border"],"border-left":["border"],"border-left-color":["border-left","border-color","border"],"border-left-style":["border-left","border-style","border"],"border-left-width":["border-left","border-width","border"],"border-right":["border"],"border-right-color":["border-right","border-color","border"],"border-right-style":["border-right","border-style","border"],"border-right-width":["border-right","border-width","border"],"border-top":["border"],"border-top-color":["border-top","border-color","border"],"border-top-style":["border-top","border-style","border"],"border-top-width":["border-top","border-width","border"],"font-family":["font"],"font-size":["font"],"font-style":["font"],"font-variant":["font"],"font-weight":["font"],"transition-delay":["transition"],"transition-duration":["transition"],"transition-property":["transition"],"transition-timing-function":["transition"],"-moz-transition-delay":["-moz-transition"],"-moz-transition-duration":["-moz-transition"],"-moz-transition-property":["-moz-transition"],"-moz-transition-timing-function":["-moz-transition"],"-o-transition-delay":["-o-transition"],"-o-transition-duration":["-o-transition"],"-o-transition-property":["-o-transition"],"-o-transition-timing-function":["-o-transition"],"-webkit-transition-delay":["-webkit-transition"],"-webkit-transition-duration":["-webkit-transition"],"-webkit-transition-property":["-webkit-transition"],"-webkit-transition-timing-function":["-webkit-transition"]};module.exports=optimize;