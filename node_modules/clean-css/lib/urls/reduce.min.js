function byUrl(e,t,r){for(var o,n=0,i=0,a=0,s=!1,u=0,l=[],c=e.indexOf(UPPERCASE_URL_PREFIX)>-1;a<e.length&&(n=e.indexOf(URL_PREFIX,a),i=c?e.indexOf(UPPERCASE_URL_PREFIX,a):-1,-1!=n||-1!=i);){-1==n&&i>-1&&(n=i),'"'==e[n+URL_PREFIX.length]?a=e.indexOf(DOUBLE_QUOTE_URL_SUFFIX,n):"'"==e[n+URL_PREFIX.length]?a=e.indexOf(SINGLE_QUOTE_URL_SUFFIX,n):(s=DATA_URI_PREFIX_PATTERN.test(e.substring(n+URL_PREFIX.length)),s?(o=split(e.substring(n),DATA_URI_TRAILER_PATTERN,!1,"(",")",!0).pop(),a=o&&o[o.length-1]==URL_SUFFIX?n+o.length-URL_SUFFIX.length:-1):a=e.indexOf(URL_SUFFIX,n)),-1==a?(a=e.indexOf("}",n),-1==a?a=e.length:a--,t.warnings.push("Broken URL declaration: '"+e.substring(n,a+1)+"'.")):e[a]!=URL_SUFFIX&&(a=e.indexOf(URL_SUFFIX,a)),l.push(e.substring(u,n));var f=e.substring(n,a+1);r(f,l),u=a+1}return l.length>0?l.join("")+e.substring(u,e.length):e}function byImport(e,t,r){for(var f,p,n=0,i=0,a=0,o=0,s=0,u=[],l=0,c=0,h="'",d='"';o<e.length&&(n=e.indexOf(IMPORT_URL_PREFIX,o),i=e.indexOf(UPPERCASE_IMPORT_URL_PREFIX,o),-1!=n||-1!=i);){if(n>-1&&i>-1&&n>i&&(n=i),l=e.indexOf(h,n),c=e.indexOf(d,n),l>-1&&c>-1&&c>l)a=l,p=h;else if(l>-1&&c>-1&&l>c)a=c,p=d;else if(l>-1)a=l,p=h;else{if(!(c>-1))break;a=c,p=d}if(u.push(e.substring(s,a)),o=e.indexOf(p,a+1),f=e.substring(n,o),-1==o||/^@import\s+(url\(|__ESCAPED)/i.test(f)||COMMENT_END_MARKER.test(f)){s=a;break}var v=e.substring(a,o+1);r(v,u),s=o+1}return u.length>0?u.join("")+e.substring(s,e.length):e}function reduceAll(e,t,r){return e=byUrl(e,t,r),e=byImport(e,t,r)}var split=require("../utils/split"),URL_PREFIX="url(",UPPERCASE_URL_PREFIX="URL(",URL_SUFFIX=")",SINGLE_QUOTE_URL_SUFFIX="')",DOUBLE_QUOTE_URL_SUFFIX='")',DATA_URI_PREFIX_PATTERN=/^\s*['"]?\s*data:/,DATA_URI_TRAILER_PATTERN=/[\s\};,\/!]/,IMPORT_URL_PREFIX="@import",UPPERCASE_IMPORT_URL_PREFIX="@IMPORT",COMMENT_END_MARKER=/\*\//;module.exports=reduceAll;