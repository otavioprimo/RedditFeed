function isAbsolute(e){return"/"==e[0]}function isSVGMarker(e){return"#"==e[0]}function isEscaped(e){return 0===e.indexOf("__ESCAPED_URL_CLEAN_CSS__")}function isInternal(e){return/^\w+:\w+/.test(e)}function isRemote(e){return/^[^:]+?:\/\//.test(e)||0===e.indexOf("//")}function isSameOrigin(e,t){return url.parse(e).protocol==url.parse(t).protocol&&url.parse(e).host==url.parse(t).host}function isImport(e){return e.lastIndexOf(".css")===e.length-4}function isData(e){return 0===e.indexOf("data:")}function absolute(e,t){return path.resolve(path.join(t.fromBase||"",e)).replace(t.toBase,"")}function relative(e,t){return path.relative(t.toBase,path.join(t.fromBase||"",e))}function normalize(e){return isWindows?e.replace(/\\/g,"/"):e}function rebase(e,t){return isAbsolute(e)||isSVGMarker(e)||isEscaped(e)||isInternal(e)?e:t.rebase!==!1||isImport(e)?!t.imports&&isImport(e)?e:isData(e)?"'"+e+"'":isRemote(e)&&!isRemote(t.toBase)?e:isRemote(e)&&!isSameOrigin(e,t.toBase)?e:!isRemote(e)&&isRemote(t.toBase)?url.resolve(t.toBase,e):normalize(t.absolute?absolute(e,t):relative(e,t)):e}function quoteFor(e){return e.indexOf("'")>-1?'"':e.indexOf('"')>-1?"'":/\s/.test(e)||/[\(\)]/.test(e)?"'":""}function rewriteUrls(e,t,r){return reduceUrls(e,r,function(e,r){var a,n=e.replace(/^(url\()?\s*['"]?|['"]?\s*\)?$/g,""),i=e.match(/^(url\()?\s*(['"]).*?(['"])\s*\)?$/);a=t.urlQuotes&&i&&i[2]===i[3]?i[2]:quoteFor(n),r.push("url("+a+rebase(n,t)+a+")")})}var path=require("path"),url=require("url"),reduceUrls=require("./reduce"),isWindows="win32"==process.platform;module.exports=rewriteUrls;