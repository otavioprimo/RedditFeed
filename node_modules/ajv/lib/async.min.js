"use strict";function setupAsync(e,t){t!==!1&&(t=!0);var i,r=e.async,n=e.transpile;switch(typeof n){case"string":var o=TRANSPILE[n];if(!o)throw new Error("bad transpiler: "+n);return e._transpileFunc=o(e,t);case"undefined":case"boolean":if("string"==typeof r){if(i=ASYNC[r],!i)throw new Error("bad async mode: "+r);return e.transpile=i(e,t)}for(var s=0;s<MODES.length;s++){var a=MODES[s];if(setupAsync(a,!1))return util.copy(a,e),e.transpile}throw new Error("generators, nodent and regenerator are not available");case"function":return e._transpileFunc=e.transpile;default:throw new Error("bad transpiler: "+n)}}function checkGenerators(e,t){try{return new Function("(function*(){})()")(),!0}catch(r){if(t)throw new Error("generators not supported")}}function checkAsyncFunction(e,t){try{return new Function("(async function(){})()")(),!0}catch(r){if(t)throw new Error("es7 async functions not supported")}}function getRegenerator(e,t){try{return regenerator||(regenerator=require("regenerator"),regenerator.runtime()),e.async&&e.async!==!0||(e.async="es7"),regeneratorTranspile}catch(r){if(t)throw new Error("regenerator not available")}}function regeneratorTranspile(e){return regenerator.compile(e).code}function getNodent(e,t){try{return nodent||(nodent=require("nodent")({log:!1,dontInstallRequireHook:!0})),"es7"!=e.async&&(e.async&&e.async!==!0&&console.warn("nodent transpiles only es7 async functions"),e.async="es7"),nodentTranspile}catch(r){if(t)throw new Error("nodent not available")}}function nodentTranspile(e){return nodent.compile(e,"",{promises:!0,sourcemap:!1}).code}function compileAsync(e,t){function o(e,t,r){function a(r){function a(r,s){if(r)return t(r);if(!n._refs[i]&&!n._schemas[i])try{n.addSchema(s,i)}catch(a){return void t(a)}o(e,t)}var i=r.missingSchema;if(n._refs[i]||n._schemas[i])return t(new Error("Schema "+i+" is loaded but "+r.missingRef+" cannot be resolved"));var s=n._loadingSchemas[i];s?"function"==typeof s?n._loadingSchemas[i]=[s,a]:s[s.length]=a:(n._loadingSchemas[i]=a,n._opts.loadSchema(i,function(e,t){var r=n._loadingSchemas[i];if(delete n._loadingSchemas[i],"function"==typeof r)r(e,t);else for(var o=0;o<r.length;o++)r[o](e,t)}))}function u(e,n){return r?void setTimeout(function(){t(e,n)}):t(e,n)}var i;try{i=n.compile(e)}catch(s){return void(s.missingSchema?a(s):u(s))}u(null,i)}var r,n=this;try{r=this._addSchema(e)}catch(i){return void setTimeout(function(){t(i)})}if(r.validate)setTimeout(function(){t(null,r.validate)});else{if("function"!=typeof this._opts.loadSchema)throw new Error("options.loadSchema should be a function");o(e,t,!0)}}module.exports={setup:setupAsync,compile:compileAsync};var util=require("./compile/util"),ASYNC={"*":checkGenerators,"co*":checkGenerators,es7:checkAsyncFunction},TRANSPILE={nodent:getNodent,regenerator:getRegenerator},MODES=[{async:"co*"},{async:"es7",transpile:"nodent"},{async:"co*",transpile:"regenerator"}],regenerator,nodent;