function mergeFilteredToArray(e,t){return e.reduce(function(e,r){if(t(r)){var n=e[e.length-1];return Array.isArray(n)?n.push(r):e.push([r]),e}return e.push(r),e},[])}function isAbsolutePath(e){return/^[A-Z]:|^\//.test(e)}var assign=require("object-assign"),Resolver=require("./Resolver"),NodeJsInputFileSystem=require("./NodeJsInputFileSystem"),SyncNodeJsInputFileSystem=require("./SyncNodeJsInputFileSystem"),CachedInputFileSystem=require("./CachedInputFileSystem"),ParsePlugin=require("./ParsePlugin"),DescriptionFilePlugin=require("./DescriptionFilePlugin"),NextPlugin=require("./NextPlugin"),TryNextPlugin=require("./TryNextPlugin"),ModuleKindPlugin=require("./ModuleKindPlugin"),FileKindPlugin=require("./FileKindPlugin"),JoinRequestPlugin=require("./JoinRequestPlugin"),ModulesInHierachicDirectoriesPlugin=require("./ModulesInHierachicDirectoriesPlugin"),ModulesInRootPlugin=require("./ModulesInRootPlugin"),AliasPlugin=require("./AliasPlugin"),AliasFieldPlugin=require("./AliasFieldPlugin"),ConcordExtensionsPlugin=require("./ConcordExtensionsPlugin"),ConcordMainPlugin=require("./ConcordMainPlugin"),ConcordModulesPlugin=require("./ConcordModulesPlugin"),DirectoryExistsPlugin=require("./DirectoryExistsPlugin"),FileExistsPlugin=require("./FileExistsPlugin"),SymlinkPlugin=require("./SymlinkPlugin"),MainFieldPlugin=require("./MainFieldPlugin"),UseFilePlugin=require("./UseFilePlugin"),AppendPlugin=require("./AppendPlugin"),ResultPlugin=require("./ResultPlugin"),ModuleAppendPlugin=require("./ModuleAppendPlugin"),UnsafeCachePlugin=require("./UnsafeCachePlugin"),LogInfoPlugin=require("./LogInfoPlugin");exports.createResolver=function(e){var t=e.modules||["node_modules"],r=e.descriptionFiles||["package.json"],n=e.plugins||[],i=e.mainFields||["main"],a=e.aliasFields||[],o=e.mainFiles||["index"],s=e.extensions||[".js",".json",".node"],u=e.enforceExtension||!1,l=e.moduleExtensions||[],c=e.enforceModuleExtension||!1,f=e.alias||[],p="undefined"!=typeof e.symlinks?e.symlinks:!0,h=e.resolveToContext||!1,d=e.unsafeCache||!1,v=e.cachePredicate||function(){return!0},m=e.fileSystem,g=e.resolver||new Resolver(m);return s=[].concat(s),l=[].concat(l),t=mergeFilteredToArray([].concat(t),function(e){return!isAbsolutePath(e)}),i=i.map(function(e){return"string"==typeof e&&(e={name:e,forceRelative:!0}),e}),"object"!=typeof f||Array.isArray(f)||(f=Object.keys(f).map(function(e){var t=!1,r=f[e];return/\$$/.test(e)&&(t=!0,e=e.substr(0,e.length-1)),"string"==typeof r&&(r={alias:r}),r=assign({name:e,onlyModule:t},r)})),d&&"object"!=typeof d&&(d={}),d?(n.push(new UnsafeCachePlugin("resolve",v,d,"new-resolve")),n.push(new ParsePlugin("new-resolve","parsed-resolve"))):n.push(new ParsePlugin("resolve","parsed-resolve")),r.forEach(function(e){n.push(new DescriptionFilePlugin("parsed-resolve",e,"described-resolve"))}),n.push(new NextPlugin("after-parsed-resolve","described-resolve")),f.forEach(function(e){n.push(new AliasPlugin("described-resolve",e,"resolve"))}),n.push(new ConcordModulesPlugin("described-resolve",{},"resolve")),a.forEach(function(e){n.push(new AliasFieldPlugin("described-resolve",e,"resolve"))}),n.push(new ModuleKindPlugin("after-described-resolve","raw-module")),n.push(new JoinRequestPlugin("after-described-resolve","relative")),l.forEach(function(e){n.push(new ModuleAppendPlugin("raw-module",e,"module"))}),c||n.push(new TryNextPlugin("raw-module",null,"module")),t.forEach(function(e){Array.isArray(e)?n.push(new ModulesInHierachicDirectoriesPlugin("module",e,"resolve")):n.push(new ModulesInRootPlugin("module",e,"resolve"))}),r.forEach(function(e){n.push(new DescriptionFilePlugin("relative",e,"described-relative"))}),n.push(new NextPlugin("after-relative","described-relative")),n.push(new FileKindPlugin("described-relative","raw-file")),n.push(new TryNextPlugin("described-relative","as directory","directory")),n.push(new DirectoryExistsPlugin("directory","existing-directory")),h?n.push(new NextPlugin("existing-directory","resolved")):(n.push(new ConcordMainPlugin("existing-directory",{},"resolve")),i.forEach(function(e){n.push(new MainFieldPlugin("existing-directory",e,"resolve"))}),o.forEach(function(e){n.push(new UseFilePlugin("existing-directory",e,"undescribed-raw-file"))}),r.forEach(function(e){n.push(new DescriptionFilePlugin("undescribed-raw-file",e,"raw-file"))}),n.push(new NextPlugin("after-undescribed-raw-file","raw-file")),u||n.push(new TryNextPlugin("raw-file","no extension","file")),n.push(new ConcordExtensionsPlugin("raw-file",{},"file")),s.forEach(function(e){n.push(new AppendPlugin("raw-file",e,"file"))}),f.forEach(function(e){n.push(new AliasPlugin("file",e,"resolve"))}),n.push(new ConcordModulesPlugin("file",{},"resolve")),a.forEach(function(e){n.push(new AliasFieldPlugin("file",e,"resolve"))}),p&&n.push(new SymlinkPlugin("file","relative")),n.push(new FileExistsPlugin("file","existing-file")),n.push(new NextPlugin("existing-file","resolved"))),n.push(new ResultPlugin("resolved")),n.forEach(function(e){g.apply(e)}),g};