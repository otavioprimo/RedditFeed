function parseType(e){var t=e.split("+"),r=t.shift();return{type:"*"===r?null:r,features:t}}function isTypeMatched(e,t){return"string"==typeof e&&(e=parseType(e)),"string"==typeof t&&(t=parseType(t)),t.type&&t.type!==e.type?!1:t.features.every(function(t){return e.features.indexOf(t)>=0})}function isResourceTypeMatched(e,t){if(e=e.split("/"),t=t.split("/"),e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!isTypeMatched(e[r],t[r]))return!1;return!0}function isResourceTypeSupported(e,t){return e.supportedResourceTypes&&e.supportedResourceTypes.some(function(e){return isResourceTypeMatched(e,t)})}function isEnvironment(e,t){return e.environments&&e.environments.every(function(e){return isTypeMatched(e,t)})}function getGlobRegExp(e){var t=globCache[e]||(globCache[e]=globToRegExp(e));return t}function matchGlob(e,t){var r=getGlobRegExp(e);return r.exec(t)}function isGlobMatched(e,t){return!!matchGlob(e,t)}function isConditionMatched(e,t){var r=t.split("|");return r.some(function n(t){t=t.trim();var r=/^!/.test(t);if(r)return!n(t.substr(1));if(!/^[a-z]+:/.test(t))return t.indexOf("/")>=0?isResourceTypeSupported(e,t):isEnvironment(e,t);var i=/^([a-z]+):\s*/.exec(t),a=t.substr(i[0].length),o=i[1];switch(o){case"referrer":return isGlobMatched(a,e.referrer);default:return!1}})}function isKeyMatched(e,t){for(;;){var r=/^\[([^\]]+)\]\s*/.exec(t);if(!r)return t;t=t.substr(r[0].length);var n=r[1];if(!isConditionMatched(e,n))return!1}}function getField(e,t,r){var n;return Object.keys(t).forEach(function(i){var a=isKeyMatched(e,i);a===r&&(n=t[i])}),n}function getMain(e,t){return getField(e,t,"main")}function getExtensions(e,t){return getField(e,t,"extensions")}function matchModule(e,t,r){function h(e){switch(e){case"/**":var t=c[p++];return t?"/"+t:"";case"**":case"*":return c[p++]}}var n=getField(e,t,"modules");if(!n)return r;for(var i=r,a=Object.keys(n),o=0,s=0;s<a.length;s++){var u=a[s],l=isKeyMatched(e,u),c=matchGlob(l,i);if(c){var f=n[u];if("string"!=typeof f)return f;if(/^\(.+\)$/.test(l))i=i.replace(getGlobRegExp(l),f);else{var p=1;i=f.replace(/(\/?\*)?\*/g,h)}if(s=-1,o++>a.length)throw new Error("Request '"+r+"' matches recursively")}}return i}function matchType(e,t,r){var n=getField(e,t,"types");if(!n)return void 0;var i;return Object.keys(n).forEach(function(t){var a=isKeyMatched(e,t);if(isGlobMatched(a,r)){var o=n[t];if(!i&&/\/\*$/.test(o))throw new Error("value ('"+o+"') of key '"+t+"' contains '*', but there is no previous value defined");i=o.replace(/\/\*$/,"/"+i)}}),i}var globToRegExp=require("./globToRegExp").globToRegExp,globCache={};exports.parseType=parseType,exports.isTypeMatched=isTypeMatched,exports.isResourceTypeSupported=isResourceTypeSupported,exports.isEnvironment=isEnvironment,exports.isGlobMatched=isGlobMatched,exports.isConditionMatched=isConditionMatched,exports.isKeyMatched=isKeyMatched,exports.getField=getField,exports.getMain=getMain,exports.getExtensions=getExtensions,exports.matchModule=matchModule,exports.matchType=matchType;