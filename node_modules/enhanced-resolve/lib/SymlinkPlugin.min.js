function SymlinkPlugin(e,t){this.source=e,this.target=t}var getPaths=require("./getPaths"),forEachBail=require("./forEachBail"),assign=require("object-assign");module.exports=SymlinkPlugin,SymlinkPlugin.prototype.apply=function(e){var t=this.target;e.plugin(this.source,function(r,n){var i=this,a=i.fileSystem,o=getPaths(r.path),s=o.seqments,u=o.paths,l=!1;forEachBail(u.map(function(e,t){return t}),function(e,t){a.readlink(u[e],function(r,n){return!r&&n&&(s[e]=n,l=!0,/^(\/|[a-zA-z]:($|\\))/.test(n))?t(null,e):void t()})},function(a,o){if(!l)return n();var u="number"==typeof o?s.slice(0,o+1):s.slice(),c=u.reverse().reduce(function(e,t){return i.join(e,t)}),f=assign({},r,{path:c});e.doResolve(t,f,"resolved symlink to "+c,n)})})};