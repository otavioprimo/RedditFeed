function UI(t){this.width=t.width,this.wrap=t.wrap,this.rows=[]}function addBorder(t,e,n){return t.border?/[.']-+[.']/.test(e)?"":e.trim().length?n:"  ":""}function _minWidth(t){var e=t.padding||[],n=1+(e[left]||0)+(e[right]||0);return t.border&&(n+=4),n}function alignRight(t,e){t=t.trim();var n="",r=stringWidth(t);return e>r&&(n=new Array(e-r+1).join(" ")),n+t}function alignCenter(t,e){t=t.trim();var n="",r=stringWidth(t.trim());return e>r&&(n=new Array(parseInt((e-r)/2,10)+1).join(" ")),n+t}var stringWidth=require("string-width"),stripAnsi=require("strip-ansi"),wrap=require("wrap-ansi"),align={right:alignRight,center:alignCenter},top=0,right=1,bottom=2,left=3;UI.prototype.span=function(){var t=this.div.apply(this,arguments);t.span=!0},UI.prototype.div=function(){if(0===arguments.length&&this.div(""),this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments))return this._applyLayoutDSL(arguments[0]);for(var n,t=[],e=0;void 0!==(n=arguments[e]);e++)"string"==typeof n?t.push(this._colFromString(n)):t.push(n);return this.rows.push(t),t},UI.prototype._shouldApplyLayoutDSL=function(){return 1===arguments.length&&"string"==typeof arguments[0]&&/[\t\n]/.test(arguments[0])},UI.prototype._applyLayoutDSL=function(t){var e=this,n=t.split("\n"),r=0;return n.forEach(function(t){var n=t.split("	");n.length>1&&stringWidth(n[0])>r&&(r=Math.min(Math.floor(.5*e.width),stringWidth(n[0])))}),n.forEach(function(t){var n=t.split("	");e.div.apply(e,n.map(function(t,i){return{text:t.trim(),padding:e._measurePadding(t),width:0===i&&n.length>1?r:void 0}}))}),this.rows[this.rows.length-1]},UI.prototype._colFromString=function(t){return{text:t,padding:this._measurePadding(t)}},UI.prototype._measurePadding=function(t){var e=stripAnsi(t);return[0,e.match(/\s*$/)[0].length,0,e.match(/^\s*/)[0].length]},UI.prototype.toString=function(){var t=this,e=[];return t.rows.forEach(function(n,r){t.rowToString(n,e)}),e=e.filter(function(t){return!t.hidden}),e.map(function(t){return t.text}).join("\n")},UI.prototype.rowToString=function(t,e){var r,s,a,c,n=this,i=this._rasterize(t),o="";return i.forEach(function(i,l){o="",i.forEach(function(i,u){s="",a=t[u].width,c=n._negatePadding(t[u]),s+=i;for(var h=0;h<c-stringWidth(i);h++)s+=" ";t[u].align&&"left"!==t[u].align&&n.wrap&&(s=align[t[u].align](s,c),stringWidth(s)<c&&(s+=new Array(a-stringWidth(s)).join(" "))),r=t[u].padding||[0,0,0,0],r[left]&&(o+=new Array(r[left]+1).join(" ")),o+=addBorder(t[u],s,"| "),o+=s,o+=addBorder(t[u],s," |"),r[right]&&(o+=new Array(r[right]+1).join(" ")),0===l&&e.length>0&&(o=n._renderInline(o,e[e.length-1]))}),e.push({text:o.replace(/ +$/,""),span:t.span})}),e},UI.prototype._renderInline=function(t,e){var n=t.match(/^ */)[0].length,r=e.text,i=stringWidth(r.trimRight());return e.span?this.wrap?i>n?t:(e.hidden=!0,r.trimRight()+new Array(n-i+1).join(" ")+t.trimLeft()):(e.hidden=!0,r+t):t},UI.prototype._rasterize=function(t){var n,r,s,e=this,i=[],o=this._columnWidths(t);return t.forEach(function(t,a){if(t.width=o[a],s=e.wrap?wrap(t.text,e._negatePadding(t),{hard:!0}).split("\n"):t.text.split("\n"),t.border&&(s.unshift("."+new Array(e._negatePadding(t)+3).join("-")+"."),s.push("'"+new Array(e._negatePadding(t)+3).join("-")+"'")),t.padding){for(n=0;n<(t.padding[top]||0);n++)s.unshift("");for(n=0;n<(t.padding[bottom]||0);n++)s.push("")}s.forEach(function(t,e){i[e]||i.push([]),r=i[e];for(var n=0;a>n;n++)void 0===r[n]&&r.push("");r.push(t)})}),i},UI.prototype._negatePadding=function(t){var e=t.width;return t.padding&&(e-=(t.padding[left]||0)+(t.padding[right]||0)),t.border&&(e-=4),e},UI.prototype._columnWidths=function(t){var i,e=this,n=[],r=t.length,o=this.width;return t.forEach(function(t,e){t.width?(r--,n[e]=t.width,o-=t.width):n[e]=void 0}),r&&(i=Math.floor(o/r)),n.forEach(function(r,o){e.wrap?void 0===r&&(n[o]=Math.max(i,_minWidth(t[o]))):n[o]=t[o].width||stringWidth(t[o].text)}),n},module.exports=function(t){return t=t||{},new UI({width:(t||{}).width||80,wrap:"boolean"==typeof t.wrap?t.wrap:!0})};