function unstupid(t,e){return t.length>=e?t:unstupid("0"+t,e)}var crypto=require("crypto"),BigInteger=require("jsbn").BigInteger,ECPointFp=require("./lib/ec.js").ECPointFp;exports.ECCurves=require("./lib/sec.js"),exports.ECKey=function(t,e,n){var r,i=t(),o=i.getN(),s=Math.floor(o.bitLength()/8);if(e)if(n){var t=i.getCurve();this.P=t.decodePointHex(e.toString("hex"))}else{if(e.length!=s)return!1;r=new BigInteger(e.toString("hex"),16)}else{var a=o.subtract(BigInteger.ONE),c=new BigInteger(crypto.randomBytes(o.bitLength()));r=c.mod(a).add(BigInteger.ONE),this.P=i.getG().multiply(r)}this.P&&(this.PublicKey=new Buffer(i.getCurve().encodeCompressedPointHex(this.P),"hex")),r&&(this.PrivateKey=new Buffer(unstupid(r.toString(16),2*s),"hex"),this.deriveSharedSecret=function(t){if(!t||!t.P)return!1;var e=t.P.multiply(r);return new Buffer(unstupid(e.getX().toBigInteger().toString(16),2*s),"hex")})};