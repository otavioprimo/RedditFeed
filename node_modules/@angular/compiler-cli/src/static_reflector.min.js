"use strict";function expandedMessage(e){switch(e.message){case"Reference to non-exported class":if(e.context&&e.context.className)return"Reference to a non-exported class "+e.context.className+". Consider exporting the class";break;case"Variable not initialized":return"Only initialized variables and constants can be referenced because the value of this variable is needed by the template compiler";case"Destructuring not supported":return"Referencing an exported destructured variable or constant is not supported by the template compiler. Consider simplifying this to avoid destructuring";case"Could not resolve type":if(e.context&&e.context.typeName)return"Could not resolve type "+e.context.typeName;break;case"Function call not supported":var t=e.context&&e.context.name?"Calling function '"+e.context.name+"', f":"F";return t+"unction calls are not supported. Consider replacing the function or lambda with a reference to an exported function";case"Reference to a local symbol":if(e.context&&e.context.name)return"Reference to a local (non-exported) symbol '"+e.context.name+"'. Consider exporting the symbol"}return e.message}function produceErrorMessage(e){return"Error encountered resolving symbol values statically. "+expandedMessage(e)}function mapStringMap(e,t){if(!e)return{};var r={};return Object.keys(e).forEach(function(n){var i=t(e[n],n);shouldIgnore(i)||(r[n]=i)}),r}function isPrimitive(e){return null===e||"function"!=typeof e&&"object"!=typeof e}function sameSymbol(e,t){return e===t||e.name==t.name&&e.filePath==t.filePath}function shouldIgnore(e){return e&&"ignore"==e.__symbolic}var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},core_1=require("@angular/core"),SUPPORTED_SCHEMA_VERSION=1,StaticSymbol=function(){function e(e,t,r){this.filePath=e,this.name=t,this.members=r}return e}();exports.StaticSymbol=StaticSymbol;var StaticReflector=function(){function e(e){this.host=e,this.annotationCache=new Map,this.propertyCache=new Map,this.parameterCache=new Map,this.metadataCache=new Map,this.conversionMap=new Map,this.initializeConversionMap()}return e.prototype.importUri=function(e){var t=this.host.findDeclaration(e.filePath,e.name,"");return t?t.filePath:null},e.prototype.resolveIdentifier=function(e,t,r){var n=this.host.findDeclaration(t,e,"");return n},e.prototype.resolveEnum=function(e,t){var r=e;return this.host.getStaticSymbol(r.filePath,r.name,[t])},e.prototype.annotations=function(e){var t=this.annotationCache.get(e);if(!t){var r=this.getTypeMetadata(e);t=r.decorators?this.simplify(e,r.decorators):[],this.annotationCache.set(e,t.filter(function(e){return!!e}))}return t},e.prototype.propMetadata=function(e){var t=this,r=this.propertyCache.get(e);if(!r){var n=this.getTypeMetadata(e),i=n?n.members:{};r=mapStringMap(i,function(r,n){var i=r.find(function(e){return"property"==e.__symbolic||"method"==e.__symbolic});return i&&i.decorators?t.simplify(e,i.decorators):[]}),this.propertyCache.set(e,r)}return r},e.prototype.parameters=function(e){if(!(e instanceof StaticSymbol))throw new Error("parameters received "+JSON.stringify(e)+" which is not a StaticSymbol");try{var t=this.parameterCache.get(e);if(!t){var r=this.getTypeMetadata(e),n=r?r.members:null,i=n?n.__ctor__:null;if(i){var o=i.find(function(e){return"constructor"==e.__symbolic}),s=this.simplify(e,o.parameters||[]),a=this.simplify(e,o.parameterDecorators||[]);t=[],s.forEach(function(e,r){var n=[];e&&n.push(e);var i=a?a[r]:null;i&&n.push.apply(n,i),t.push(n)})}t||(t=[]),this.parameterCache.set(e,t)}return t}catch(u){throw console.log("Failed on type "+JSON.stringify(e)+" with error "+u),u}},e.prototype.hasLifecycleHook=function(e,t){if(!(e instanceof StaticSymbol))throw new Error("hasLifecycleHook received "+JSON.stringify(e)+" which is not a StaticSymbol");var r=this.getTypeMetadata(e),n=r?r.members:null,i=n&&n.hasOwnProperty(t)?n[t]:null;return i?i.some(function(e){return"method"==e.__symbolic}):!1},e.prototype.registerDecoratorOrConstructor=function(e,t){this.conversionMap.set(e,function(e,r){return new(t.bind.apply(t,[void 0].concat(r)))})},e.prototype.registerFunction=function(e,t){this.conversionMap.set(e,function(e,r){return t.apply(void 0,r)})},e.prototype.initializeConversionMap=function(){var e=this.host.angularImportLocations(),t=e.coreDecorators,r=e.diDecorators,n=e.diMetadata,i=e.diOpaqueToken,o=e.animationMetadata;e.provider;this.opaqueToken=this.host.findDeclaration(i,"OpaqueToken"),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"Host"),core_1.Host),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"Injectable"),core_1.Injectable),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"Self"),core_1.Self),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"SkipSelf"),core_1.SkipSelf),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"Inject"),core_1.Inject),this.registerDecoratorOrConstructor(this.host.findDeclaration(r,"Optional"),core_1.Optional),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Attribute"),core_1.Attribute),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"ContentChild"),core_1.ContentChild),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"ContentChildren"),core_1.ContentChildren),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"ViewChild"),core_1.ViewChild),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"ViewChildren"),core_1.ViewChildren),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Input"),core_1.Input),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Output"),core_1.Output),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Pipe"),core_1.Pipe),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"HostBinding"),core_1.HostBinding),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"HostListener"),core_1.HostListener),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Directive"),core_1.Directive),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"Component"),core_1.Component),this.registerDecoratorOrConstructor(this.host.findDeclaration(t,"NgModule"),core_1.NgModule),this.registerDecoratorOrConstructor(this.host.findDeclaration(n,"Host"),core_1.Host),this.registerDecoratorOrConstructor(this.host.findDeclaration(n,"Self"),core_1.Self),this.registerDecoratorOrConstructor(this.host.findDeclaration(n,"SkipSelf"),core_1.SkipSelf),this.registerDecoratorOrConstructor(this.host.findDeclaration(n,"Optional"),core_1.Optional),this.registerFunction(this.host.findDeclaration(o,"trigger"),core_1.trigger),this.registerFunction(this.host.findDeclaration(o,"state"),core_1.state),this.registerFunction(this.host.findDeclaration(o,"transition"),core_1.transition),this.registerFunction(this.host.findDeclaration(o,"style"),core_1.style),this.registerFunction(this.host.findDeclaration(o,"animate"),core_1.animate),this.registerFunction(this.host.findDeclaration(o,"keyframes"),core_1.keyframes),this.registerFunction(this.host.findDeclaration(o,"sequence"),core_1.sequence),this.registerFunction(this.host.findDeclaration(o,"group"),core_1.group)},e.prototype.simplify=function(e,t){function o(e,t,s){function a(e,t){var n;return n=t.module?r.host.findDeclaration(t.module,t.name,e.filePath):r.host.getStaticSymbol(e.filePath,t.name)}function u(e){var n=r.getModuleMetadata(e.filePath),i=n?n.metadata[e.name]:null;return i}function c(e,t){if(t&&"new"===t.__symbolic&&t.expression){var n=t.expression;if("reference"==n.__symbolic)return sameSymbol(a(e,n),r.opaqueToken)}return!1}function l(t){var r=void 0;if("call"==t.__symbolic){var c=t.expression,l=void 0,h=void 0;if(c)switch(c.__symbolic){case"reference":r={name:c.name},l=a(e,c),h=u(l);break;case"select":if("reference"==c.expression.__symbolic){l=a(e,c.expression);var f=u(l);f&&f.statics&&(h=f.statics[c.member])}}if(h&&"function"==h.__symbolic){if(i.get(l))throw new Error("Recursion not supported");i.set(l,!0);try{var v=h.value;if(v&&(0!=s||"error"!=v.__symbolic)){var d=(t.arguments||[]).map(function(e){return p(e)}),m=h.parameters,y=h.defaults;y&&y.length>d.length&&d.push.apply(d,y.slice(d.length).map(function(e){return p(e)}));for(var g=BindingScope.build(),_=0;_<m.length;_++)g.define(m[_],d[_]);var E,w=n;try{n=g.done(),E=o(l,v,s+1)}finally{n=w}return E}}finally{i["delete"](l)}}}return 0===s?{__symbolic:"ignore"}:p({__symbolic:"error",message:"Function call not supported",context:r})}function p(t){if(isPrimitive(t))return t;if(t instanceof Array){for(var i=[],h=0,f=t;h<f.length;h++){var v=f[h];if(v&&"spread"===v.__symbolic){var d=p(v.expression);if(Array.isArray(d)){for(var m=0,y=d;m<y.length;m++){var g=y[m];i.push(g)}continue}}var _=p(v);shouldIgnore(_)||i.push(_)}return i}if(t instanceof StaticSymbol)return t;if(t){if(t.__symbolic){var w=void 0;switch(t.__symbolic){case"binop":var E=p(t.left);if(shouldIgnore(E))return E;var C=p(t.right);if(shouldIgnore(C))return C;switch(t.operator){case"&&":return E&&C;case"||":return E||C;case"|":return E|C;case"^":return E^C;case"&":return E&C;case"==":return E==C;case"!=":return E!=C;case"===":return E===C;case"!==":return E!==C;case"<":return C>E;case">":return E>C;case"<=":return C>=E;case">=":return E>=C;case"<<":return E<<C;case">>":return E>>C;case"+":return E+C;case"-":return E-C;case"*":return E*C;case"/":return E/C;case"%":return E%C}return null;case"if":var S=p(t.condition);return p(S?t.thenExpression:t.elseExpression);case"pre":var x=p(t.operand);if(shouldIgnore(x))return x;switch(t.operator){case"+":return x;case"-":return-x;case"!":return!x;case"~":return~x}return null;case"index":var b=p(t.expression),T=p(t.index);return b&&isPrimitive(T)?b[T]:null;case"select":var M=p(t.expression);if(M instanceof StaticSymbol){var A=u(M);if(!A||!A.statics){var P=t.member,k=M.members?M.members.concat(P):[P];return r.host.getStaticSymbol(M.filePath,M.name,k)}M=A.statics}var O=p(t.member);return M&&isPrimitive(O)?p(M[O]):null;case"reference":if(!t.module){var I=t.name,N=n.resolve(I);if(N!=BindingScope.missing)return N}w=a(e,t);var D=w,R=u(D);if(R){if(c(w,R))return w;D=o(w,R,s+1)}return D;case"class":return e;case"function":return e;case"new":case"call":var L=t.expression;w=L.module?r.host.findDeclaration(L.module,L.name,e.filePath):r.host.getStaticSymbol(e.filePath,L.name);var V=r.conversionMap.get(w);if(V){var F=t.arguments;return F||(F=[]),V(e,F.map(function(t){return o(e,t,s+1)}))}return l(t);case"error":var U=produceErrorMessage(t);throw t.line&&(U=U+" (position "+(t.line+1)+":"+(t.character+1)+" in the original .ts file)"),new Error(U)}return null}return mapStringMap(t,function(e,t){return p(e)})}return null}try{return p(t)}catch(h){throw new Error(h.message+", resolving symbol "+e.name+" in "+e.filePath)}}var r=this,n=BindingScope.empty,i=new Map,s=o(e,t,0);return shouldIgnore(s)?void 0:s},e.prototype.getModuleMetadata=function(e){var t=this.metadataCache.get(e);if(!t){if(t=this.host.getMetadataFor(e),Array.isArray(t)&&(t=t.find(function(e){return e.version===SUPPORTED_SCHEMA_VERSION})||t[0]),t||(t={__symbolic:"module",version:SUPPORTED_SCHEMA_VERSION,module:e,metadata:{}}),t.version!=SUPPORTED_SCHEMA_VERSION)throw new Error("Metadata version mismatch for module "+e+", found version "+t.version+", expected "+SUPPORTED_SCHEMA_VERSION);this.metadataCache.set(e,t)}return t},e.prototype.getTypeMetadata=function(e){var t=this.getModuleMetadata(e.filePath),r=t.metadata[e.name];return r||(r={__symbolic:"class"}),r},e}();exports.StaticReflector=StaticReflector;var BindingScope=function(){function e(){}return e.build=function(){var t=new Map;return{define:function(e,r){return t.set(e,r),this},done:function(){return t.size>0?new PopulatedScope(t):e.empty}}},e.missing={},e.empty={resolve:function(t){return e.missing}},e}(),PopulatedScope=function(e){function t(t){e.call(this),this.bindings=t}return __extends(t,e),t.prototype.resolve=function(e){return this.bindings.has(e)?this.bindings.get(e):BindingScope.missing},t}(BindingScope);