"use strict";function main(e,t,r){try{var n=e;fs.lstatSync(e).isFile()&&(n=path.dirname(e));var i=path.resolve(process.cwd(),t.basePath||n),o=tsc_1.tsc.readConfiguration(e,i),s=o.parsed,a=o.ngOptions;a.basePath=i;var u=ts.createCompilerHost(s.options,!0);u.realpath=function(e){return e};var c=ts.createProgram(s.fileNames,s.options,u),l=c.getOptionsDiagnostics();return tsc_1.check(l),(a.skipTemplateCodegen||!r)&&(r=function(){return Promise.resolve(null)}),r(a,t,c,u).then(function(){var e=ts.createProgram(s.fileNames,s.options,u,c);tsc_1.tsc.typeCheck(u,e);var t=new compiler_host_1.TsickleHost(u,e);if(tsc_1.tsc.emit(t,e),!a.skipMetadataEmit){var r=new compiler_host_1.MetadataWriterHost(u,e,a);tsc_1.tsc.emit(r,e)}})}catch(p){return Promise.reject(p)}}var fs=require("fs"),path=require("path"),ts=require("typescript"),tsc_1=require("./tsc"),compiler_host_1=require("./compiler_host"),cli_options_1=require("./cli_options");if(exports.main=main,require.main===module){var args_1=require("minimist")(process.argv.slice(2)),project=args_1.p||args_1.project||".",cliOptions=new cli_options_1.CliOptions(args_1);main(project,cliOptions).then(function(e){return process.exit(e)})["catch"](function(e){console.error(e.stack),console.error("Compilation failed"),process.exit(1)})}