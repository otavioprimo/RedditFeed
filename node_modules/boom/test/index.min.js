var Code=require("code"),Boom=require("../lib"),Lab=require("lab"),internals={},lab=exports.lab=Lab.script(),describe=lab.describe,it=lab.it,expect=Code.expect;it("returns the same object when already boom",function(e){var t=Boom.badRequest(),r=Boom.wrap(t);expect(t).to.equal(r),e()}),it("returns an error with info when constructed using another error",function(e){var t=new Error("ka-boom");t.xyz=123;var r=Boom.wrap(t);expect(r.xyz).to.equal(123),expect(r.message).to.equal("ka-boom"),expect(r.output).to.deep.equal({statusCode:500,payload:{statusCode:500,error:"Internal Server Error",message:"An internal server error occurred"},headers:{}}),expect(r.data).to.equal(null),e()}),it("does not override data when constructed using another error",function(e){var t=new Error("ka-boom");t.data={useful:"data"};var r=Boom.wrap(t);expect(r.data).to.equal(t.data),e()}),it("sets new message when none exists",function(e){var t=new Error,r=Boom.wrap(t,400,"something bad");expect(r.message).to.equal("something bad"),e()}),it("throws when statusCode is not a number",function(e){expect(function(){Boom.create("x")}).to["throw"]("First argument must be a number (400+): x"),e()}),it("will cast a number-string to an integer",function(e){for(var t=[{input:"404",result:404},{input:"404.1",result:404},{input:400,result:400},{input:400.123,result:400}],r=0,n=t.length;n>r;++r){var i=t[r],o=Boom.create(i.input);expect(o.output.statusCode).to.equal(i.result)}e()}),it("throws when statusCode is not finite",function(e){expect(function(){Boom.create(1/0)}).to["throw"]("First argument must be a number (400+): null"),e()}),it("sets error code to unknown",function(e){var t=Boom.create(999);expect(t.output.payload.error).to.equal("Unknown"),e()}),describe("create()",function(){it("does not sets null message",function(e){var t=Boom.unauthorized(null);expect(t.output.payload.message).to.not.exist(),expect(t.isServer).to.be["false"](),e()}),it("sets message and data",function(e){var t=Boom.badRequest("Missing data",{type:"user"});expect(t.data.type).to.equal("user"),expect(t.output.payload.message).to.equal("Missing data"),e()})}),describe("isBoom()",function(){it("returns true for Boom object",function(e){expect(Boom.badRequest().isBoom).to.equal(!0),e()}),it("returns false for Error object",function(e){expect((new Error).isBoom).to.not.exist(),e()})}),describe("badRequest()",function(){it("returns a 400 error statusCode",function(e){var t=Boom.badRequest();expect(t.output.statusCode).to.equal(400),expect(t.isServer).to.be["false"](),e()}),it("sets the message with the passed in message",function(e){expect(Boom.badRequest("my message").message).to.equal("my message"),e()}),it("sets the message to HTTP status if none provided",function(e){expect(Boom.badRequest().message).to.equal("Bad Request"),e()})}),describe("unauthorized()",function(){it("returns a 401 error statusCode",function(e){var t=Boom.unauthorized();expect(t.output.statusCode).to.equal(401),expect(t.output.headers).to.deep.equal({}),e()}),it("sets the message with the passed in message",function(e){expect(Boom.unauthorized("my message").message).to.equal("my message"),e()}),it("returns a WWW-Authenticate header when passed a scheme",function(e){var t=Boom.unauthorized("boom","Test");expect(t.output.statusCode).to.equal(401),expect(t.output.headers["WWW-Authenticate"]).to.equal('Test error="boom"'),e()}),it("returns a WWW-Authenticate header set to the schema array value",function(e){var t=Boom.unauthorized(null,["Test","one","two"]);expect(t.output.statusCode).to.equal(401),expect(t.output.headers["WWW-Authenticate"]).to.equal("Test, one, two"),e()}),it("returns a WWW-Authenticate header when passed a scheme and attributes",function(e){var t=Boom.unauthorized("boom","Test",{a:1,b:"something",c:null,d:0});expect(t.output.statusCode).to.equal(401),expect(t.output.headers["WWW-Authenticate"]).to.equal('Test a="1", b="something", c="", d="0", error="boom"'),expect(t.output.payload.attributes).to.deep.equal({a:1,b:"something",c:"",d:0,error:"boom"}),e()}),it("returns a WWW-Authenticate header when passed attributes, missing error",function(e){var t=Boom.unauthorized(null,"Test",{a:1,b:"something",c:null,d:0});expect(t.output.statusCode).to.equal(401),expect(t.output.headers["WWW-Authenticate"]).to.equal('Test a="1", b="something", c="", d="0"'),expect(t.isMissing).to.equal(!0),e()}),it("sets the isMissing flag when error message is empty",function(e){var t=Boom.unauthorized("","Basic");expect(t.isMissing).to.equal(!0),e()}),it("does not set the isMissing flag when error message is not empty",function(e){var t=Boom.unauthorized("message","Basic");expect(t.isMissing).to.equal(void 0),e()}),it("sets a WWW-Authenticate when passed as an array",function(e){var t=Boom.unauthorized("message",["Basic",'Example e="1"','Another x="3", y="4"']);expect(t.output.headers["WWW-Authenticate"]).to.equal('Basic, Example e="1", Another x="3", y="4"'),e()})}),describe("methodNotAllowed()",function(){it("returns a 405 error statusCode",function(e){expect(Boom.methodNotAllowed().output.statusCode).to.equal(405),e()}),it("sets the message with the passed in message",function(e){expect(Boom.methodNotAllowed("my message").message).to.equal("my message"),e()})}),describe("notAcceptable()",function(){it("returns a 406 error statusCode",function(e){expect(Boom.notAcceptable().output.statusCode).to.equal(406),e()}),it("sets the message with the passed in message",function(e){expect(Boom.notAcceptable("my message").message).to.equal("my message"),e()})}),describe("proxyAuthRequired()",function(){it("returns a 407 error statusCode",function(e){expect(Boom.proxyAuthRequired().output.statusCode).to.equal(407),e()}),it("sets the message with the passed in message",function(e){expect(Boom.proxyAuthRequired("my message").message).to.equal("my message"),e()})}),describe("clientTimeout()",function(){it("returns a 408 error statusCode",function(e){expect(Boom.clientTimeout().output.statusCode).to.equal(408),e()}),it("sets the message with the passed in message",function(e){expect(Boom.clientTimeout("my message").message).to.equal("my message"),e()})}),describe("conflict()",function(){it("returns a 409 error statusCode",function(e){expect(Boom.conflict().output.statusCode).to.equal(409),e()}),it("sets the message with the passed in message",function(e){expect(Boom.conflict("my message").message).to.equal("my message"),e()})}),describe("resourceGone()",function(){it("returns a 410 error statusCode",function(e){expect(Boom.resourceGone().output.statusCode).to.equal(410),e()}),it("sets the message with the passed in message",function(e){expect(Boom.resourceGone("my message").message).to.equal("my message"),e()})}),describe("lengthRequired()",function(){it("returns a 411 error statusCode",function(e){expect(Boom.lengthRequired().output.statusCode).to.equal(411),e()}),it("sets the message with the passed in message",function(e){expect(Boom.lengthRequired("my message").message).to.equal("my message"),e()})}),describe("preconditionFailed()",function(){it("returns a 412 error statusCode",function(e){expect(Boom.preconditionFailed().output.statusCode).to.equal(412),e()}),it("sets the message with the passed in message",function(e){expect(Boom.preconditionFailed("my message").message).to.equal("my message"),e()})}),describe("entityTooLarge()",function(){it("returns a 413 error statusCode",function(e){expect(Boom.entityTooLarge().output.statusCode).to.equal(413),e()}),it("sets the message with the passed in message",function(e){expect(Boom.entityTooLarge("my message").message).to.equal("my message"),e()})}),describe("uriTooLong()",function(){it("returns a 414 error statusCode",function(e){expect(Boom.uriTooLong().output.statusCode).to.equal(414),e()}),it("sets the message with the passed in message",function(e){expect(Boom.uriTooLong("my message").message).to.equal("my message"),e()})}),describe("unsupportedMediaType()",function(){it("returns a 415 error statusCode",function(e){expect(Boom.unsupportedMediaType().output.statusCode).to.equal(415),e()}),it("sets the message with the passed in message",function(e){expect(Boom.unsupportedMediaType("my message").message).to.equal("my message"),e()})}),describe("rangeNotSatisfiable()",function(){it("returns a 416 error statusCode",function(e){expect(Boom.rangeNotSatisfiable().output.statusCode).to.equal(416),e()}),it("sets the message with the passed in message",function(e){expect(Boom.rangeNotSatisfiable("my message").message).to.equal("my message"),e()})}),describe("expectationFailed()",function(){it("returns a 417 error statusCode",function(e){expect(Boom.expectationFailed().output.statusCode).to.equal(417),e()}),it("sets the message with the passed in message",function(e){expect(Boom.expectationFailed("my message").message).to.equal("my message"),e()})}),describe("badData()",function(){it("returns a 422 error statusCode",function(e){expect(Boom.badData().output.statusCode).to.equal(422),e()}),it("sets the message with the passed in message",function(e){expect(Boom.badData("my message").message).to.equal("my message"),e()})}),describe("preconditionRequired()",function(){it("returns a 428 error statusCode",function(e){expect(Boom.preconditionRequired().output.statusCode).to.equal(428),e()}),it("sets the message with the passed in message",function(e){expect(Boom.preconditionRequired("my message").message).to.equal("my message"),e()})}),describe("tooManyRequests()",function(){it("returns a 429 error statusCode",function(e){expect(Boom.tooManyRequests().output.statusCode).to.equal(429),e()}),it("sets the message with the passed-in message",function(e){expect(Boom.tooManyRequests("my message").message).to.equal("my message"),e()})}),describe("serverTimeout()",function(){it("returns a 503 error statusCode",function(e){expect(Boom.serverTimeout().output.statusCode).to.equal(503),e()}),it("sets the message with the passed in message",function(e){expect(Boom.serverTimeout("my message").message).to.equal("my message"),e()})}),describe("forbidden()",function(){it("returns a 403 error statusCode",function(e){expect(Boom.forbidden().output.statusCode).to.equal(403),e()}),it("sets the message with the passed in message",function(e){expect(Boom.forbidden("my message").message).to.equal("my message"),e()})}),describe("notFound()",function(){it("returns a 404 error statusCode",function(e){expect(Boom.notFound().output.statusCode).to.equal(404),e()}),it("sets the message with the passed in message",function(e){expect(Boom.notFound("my message").message).to.equal("my message"),e()})}),describe("internal()",function(){it("returns a 500 error statusCode",function(e){expect(Boom.internal().output.statusCode).to.equal(500),e()}),it("sets the message with the passed in message",function(e){var t=Boom.internal("my message");expect(t.message).to.equal("my message"),expect(t.isServer).to["true"](),expect(t.output.payload.message).to.equal("An internal server error occurred"),e()}),it("passes data on the callback if its passed in",function(e){expect(Boom.internal("my message",{my:"data"}).data.my).to.equal("data"),e()}),it("returns an error with composite message",function(e){try{JSON.parse("{")}catch(t){var r=Boom.internal("Someting bad",t);expect(r.message).to.equal("Someting bad: Unexpected end of input"),expect(r.isServer).to.be["true"](),e()}})}),describe("notImplemented()",function(){it("returns a 501 error statusCode",function(e){expect(Boom.notImplemented().output.statusCode).to.equal(501),e()}),it("sets the message with the passed in message",function(e){expect(Boom.notImplemented("my message").message).to.equal("my message"),e()})}),describe("badGateway()",function(){it("returns a 502 error statusCode",function(e){expect(Boom.badGateway().output.statusCode).to.equal(502),e()}),it("sets the message with the passed in message",function(e){expect(Boom.badGateway("my message").message).to.equal("my message"),e()})}),describe("gatewayTimeout()",function(){it("returns a 504 error statusCode",function(e){expect(Boom.gatewayTimeout().output.statusCode).to.equal(504),e()}),it("sets the message with the passed in message",function(e){expect(Boom.gatewayTimeout("my message").message).to.equal("my message"),e()})}),describe("badImplementation()",function(){it("returns a 500 error statusCode",function(e){var t=Boom.badImplementation();expect(t.output.statusCode).to.equal(500),expect(t.isDeveloperError).to.equal(!0),expect(t.isServer).to.be["true"](),e()})}),describe("stack trace",function(){it("should omit lib",function(e){["badRequest","unauthorized","forbidden","notFound","methodNotAllowed","notAcceptable","proxyAuthRequired","clientTimeout","conflict","resourceGone","lengthRequired","preconditionFailed","entityTooLarge","uriTooLong","unsupportedMediaType","rangeNotSatisfiable","expectationFailed","badData","preconditionRequired","tooManyRequests","internal","notImplemented","badGateway","serverTimeout","gatewayTimeout","badImplementation"].forEach(function(e){var t=Boom[e]();expect(t.stack).to.not.match(/\/lib\/index\.js/)}),e()})});