(function(){var e,t,r,n,i,o,a,s,u,l,c,p,f;e=require("./browsers"),n=require("./brackets"),r=require("./value"),c=require("./utils"),a=require("postcss"),l=[],o=require("caniuse-db/features-json/css-featurequeries.json"),s=o.stats;for(i in s){f=s[i];for(p in f)u=f[p],/y/.test(u)&&l.push(i+" "+p)}t=function(){function t(e,t){this.Prefixes=e,this.all=t}return t.prototype.prefixer=function(){var t,r;return this.prefixerCache?this.prefixerCache:(r=this.all.browsers.selected.filter(function(e){return function(e){return-1!==l.indexOf(e)}}(this)),t=new e(this.all.browsers.data,r,this.all.options),this.prefixerCache=new this.Prefixes(this.all.data,t,this.all.options))},t.prototype.parse=function(e){var t,r,n;return r=e.split(":"),t=r[0],n=r[1],n||(n=""),[t.trim(),n.trim()]},t.prototype.virtual=function(e){var t,r,n,i;return r=this.parse(e),t=r[0],i=r[1],n=a.parse("a{}").first,n.append({prop:t,value:i,raws:{before:""}}),n},t.prototype.prefixed=function(e){var t,n,i,o,a,s,u,l,c,p,f;for(p=this.virtual(e),u=p.first.prop,s=this.prefixer().add[u],null!=s&&"function"==typeof s.process&&s.process(p.first),l=p.nodes,n=0,o=l.length;o>n;n++){for(t=l[n],c=this.prefixer().values("add",u),i=0,a=c.length;a>i;i++)f=c[i],f.process(t);r.save(this.all,t)}return p.nodes},t.prototype.isNot=function(e){return"string"==typeof e&&/not\s*/i.test(e)},t.prototype.isOr=function(e){return"string"==typeof e&&/\s*or\s*/i.test(e)},t.prototype.isProp=function(e){return"object"==typeof e&&1===e.length&&"string"==typeof e[0]},t.prototype.isHack=function(e,t){var r;return r=new RegExp("(\\(|\\s)"+c.escapeRegexp(t)+":"),!r.test(e)},t.prototype.toRemove=function(e,t){var r,n,i,o,a,s,u,l,c;if(a=this.parse(e),o=a[0],c=a[1],l=this.all.unprefixed(o),(null!=(s=this.all.cleaner().remove[o])?s.remove:void 0)&&!this.isHack(t,l))return!0;for(u=this.all.cleaner().values("remove",l),n=0,i=u.length;i>n;n++)if(r=u[n],r.check(c))return!0;return!1},t.prototype.remove=function(e,t){var r;for(r=0;r<e.length;)!this.isNot(e[r-1])&&this.isProp(e[r])&&this.isOr(e[r+1])?this.toRemove(e[r][0],t)?e.splice(r,2):r+=2:("object"==typeof e[r]&&(e[r]=this.remove(e[r],t)),r+=1);return e},t.prototype.cleanBrackets=function(e){return e.map(function(e){return function(t){return"object"==typeof t?1===t.length&&"object"==typeof t[0]?e.cleanBrackets(t[0]):e.cleanBrackets(t):t}}(this))},t.prototype.convert=function(e){var t,r,n,i;for(i=[""],r=0,n=e.length;n>r;r++)t=e[r],i.push([t.prop+": "+t.value]),i.push(" or ");return i[i.length-1]="",i},t.prototype.normalize=function(e){return"object"==typeof e?(e=e.filter(function(e){return""!==e}),"string"==typeof e[0]&&-1!==e[0].indexOf(":")?[n.stringify(e)]:e.map(function(e){return function(t){return e.normalize(t)}}(this))):e},t.prototype.add=function(e,t){return e.map(function(e){return function(r){var n;return e.isProp(r)?(n=e.prefixed(r[0]),n.length>1?e.convert(n):r):"object"==typeof r?e.add(r,t):r}}(this))},t.prototype.process=function(e){var t;return t=n.parse(e.params),t=this.normalize(t),t=this.remove(t,e.params),t=this.add(t,e.params),t=this.cleanBrackets(t),e.params=n.stringify(t)},t}(),module.exports=t}).call(this);