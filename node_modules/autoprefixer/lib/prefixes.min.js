(function(){var e,t,r,n,i,o,a,s,u,l,c,p,f;r=require("./declaration"),o=require("./resolution"),u=require("./transition"),i=require("./processor"),s=require("./supports"),t=require("./browsers"),a=require("./selector"),e=require("./at-rule"),l=require("./value"),p=require("./utils"),f=require("postcss/lib/vendor"),a.hack(require("./hacks/fullscreen")),a.hack(require("./hacks/placeholder")),r.hack(require("./hacks/flex")),r.hack(require("./hacks/order")),r.hack(require("./hacks/filter")),r.hack(require("./hacks/grid-end")),r.hack(require("./hacks/flex-flow")),r.hack(require("./hacks/flex-grow")),r.hack(require("./hacks/flex-wrap")),r.hack(require("./hacks/grid-start")),r.hack(require("./hacks/align-self")),r.hack(require("./hacks/flex-basis")),r.hack(require("./hacks/mask-border")),r.hack(require("./hacks/align-items")),r.hack(require("./hacks/flex-shrink")),r.hack(require("./hacks/break-props")),r.hack(require("./hacks/writing-mode")),r.hack(require("./hacks/border-image")),r.hack(require("./hacks/justify-items")),r.hack(require("./hacks/align-content")),r.hack(require("./hacks/border-radius")),r.hack(require("./hacks/block-logical")),r.hack(require("./hacks/grid-template")),r.hack(require("./hacks/inline-logical")),r.hack(require("./hacks/grid-row-align")),r.hack(require("./hacks/transform-decl")),r.hack(require("./hacks/flex-direction")),r.hack(require("./hacks/image-rendering")),r.hack(require("./hacks/justify-content")),r.hack(require("./hacks/background-size")),r.hack(require("./hacks/text-emphasis-position")),l.hack(require("./hacks/fill")),l.hack(require("./hacks/gradient")),l.hack(require("./hacks/pixelated")),l.hack(require("./hacks/image-set")),l.hack(require("./hacks/cross-fade")),l.hack(require("./hacks/flex-values")),l.hack(require("./hacks/display-flex")),l.hack(require("./hacks/display-grid")),l.hack(require("./hacks/filter-value")),c={},n=function(){function n(e,t,r){var n;this.data=e,this.browsers=t,this.options=null!=r?r:{},n=this.preprocess(this.select(this.data)),this.add=n[0],this.remove=n[1],this.transition=new u(this),this.processor=new i(this)}return n.prototype.cleaner=function(){var e;if(!this.cleanerCache){if(!this.browsers.selected.length)return this;e=new t(this.browsers.data,[]),this.cleanerCache=new n(this.data,e,this.options)}return this.cleanerCache},n.prototype.select=function(e){var t,r,n,i,o,a;a={add:{},remove:{}};for(i in e)n=e[i],t=n.browsers.map(function(e){var t;return t=e.split(" "),{browser:t[0]+" "+t[1],note:t[2]}}),o=t.filter(function(e){return e.note}).map(function(e){return function(t){return e.browsers.prefix(t.browser)+" "+t.note}}(this)),o=p.uniq(o),t=t.filter(function(e){return function(t){return e.browsers.isSelected(t.browser)}}(this)).map(function(e){return function(t){var r;return r=e.browsers.prefix(t.browser),t.note?r+" "+t.note:r}}(this)),t=this.sort(p.uniq(t)),"no-2009"===this.options.flexbox&&(t=t.filter(function(e){return-1===e.indexOf("2009")})),r=n.browsers.map(function(e){return function(t){return e.browsers.prefix(t)}}(this)),n.mistakes&&(r=r.concat(n.mistakes)),r=r.concat(o),r=p.uniq(r),t.length?(a.add[i]=t,t.length<r.length&&(a.remove[i]=r.filter(function(e){return-1===t.indexOf(e)}))):a.remove[i]=r;return a},n.prototype.sort=function(e){return e.sort(function(e,t){var r,n;return r=p.removeNote(e).length,n=p.removeNote(t).length,r===n?t.length-e.length:n-r})},n.prototype.preprocess=function(t){var i,u,c,p,h,d,v,m,g,y,_,b,w,E,x,S,C,k,P,A,T,O,N,I,R,D,M,j,q,L;i={selectors:[],"@supports":new s(n,this)},I=t.add;for(E in I)if(T=I[E],"@keyframes"===E||"@viewport"===E)i[E]=new e(E,T,this);else if("@resolution"===E)i[E]=new o(E,T,this);else if(this.data[E].selector)i.selectors.push(a.load(E,T,this));else if(N=this.data[E].props)for(q=l.load(E,T,this),u=0,h=N.length;h>u;u++)O=N[u],i[O]||(i[O]={values:[]}),i[O].values.push(q);else L=(null!=(R=i[E])?R.values:void 0)||[],i[E]=r.load(E,T,this),i[E].values=L;M={selectors:[]},D=t.remove;for(E in D)if(T=D[E],this.data[E].selector)for(j=a.load(E,T),c=0,d=T.length;d>c;c++)P=T[c],M.selectors.push(j.old(P));else if("@keyframes"===E||"@viewport"===E)for(p=0,v=T.length;v>p;p++)P=T[p],A="@"+P+E.slice(1),M[A]={remove:!0};else if("@resolution"===E)M[E]=new o(E,T,this);else if(N=this.data[E].props){for(q=l.load(E,[],this),b=0,m=T.length;m>b;b++)if(P=T[b],S=q.old(P))for(w=0,g=N.length;g>w;w++)O=N[w],M[O]||(M[O]={}),M[O].values||(M[O].values=[]),M[O].values.push(S)}else for(x=0,y=T.length;y>x;x++)for(P=T[x],O=f.unprefixed(E),C=this.decl(E).old(E,P),k=0,_=C.length;_>k;k++)A=C[k],M[A]||(M[A]={}),M[A].remove=!0;return[i,M]},n.prototype.decl=function(e){var t;return t=c[e],t?t:c[e]=r.load(e)},n.prototype.unprefixed=function(e){return this.normalize(f.unprefixed(e))},n.prototype.normalize=function(e){return this.decl(e).normalize(e)},n.prototype.prefixed=function(e,t){return e=f.unprefixed(e),this.decl(e).prefixed(e,t)},n.prototype.values=function(e,t){var r,n,i,o,a;return r=this[e],n=null!=(i=r["*"])?i.values:void 0,a=null!=(o=r[t])?o.values:void 0,n&&a?p.uniq(n.concat(a)):n||a||[]},n.prototype.group=function(e){var r,n,i,o,a;return o=e.parent,n=o.index(e),i=o.nodes.length,a=this.unprefixed(e.prop),r=function(e){return function(r,s){var u;for(n+=r;n>=0&&i>n;){if(u=o.nodes[n],"decl"===u.type){if(-1===r&&u.prop===a&&!t.withPrefix(u.value))break;if(e.unprefixed(u.prop)!==a)break;if(s(u)===!0)return!0;if(1===r&&u.prop===a&&!t.withPrefix(u.value))break}n+=r}return!1}}(this),{up:function(e){return r(-1,e)},down:function(e){return r(1,e)}}},n}(),module.exports=n}).call(this);