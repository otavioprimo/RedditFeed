!function(){"use strict";function c(e){return-1==="><(){}[],:*|?!=".indexOf(String.fromCharCode(e))&&!u.code.isWhiteSpace(e)&&!u.code.isLineTerminator(e)}function f(e,t,r,n){this._previous=e,this._index=t,this._token=r,this._value=n}function p(){var e=r.charAt(i);return i+=1,e}function h(e){var t,a,o,s=0;for(a="u"===e?4:2,t=0;a>t;++t){if(!(n>i&&u.code.isHexDigit(r.charCodeAt(i))))return"";o=p(),s=16*s+"0123456789abcdef".indexOf(o.toLowerCase())}return String.fromCharCode(s)}function d(){var a,o,c,f,d,e="";for(a=r.charAt(i),++i;n>i;){if(o=p(),o===a){a="";break}if("\\"===o)if(o=p(),u.code.isLineTerminator(o.charCodeAt(0)))"\r"===o&&10===r.charCodeAt(i)&&++i;else switch(o){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="	";break;case"u":case"x":d=i,f=h(o),f?e+=f:(i=d,e+=o);break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="";break;default:u.code.isOctalDigit(o.charCodeAt(0))?(c="01234567".indexOf(o),n>i&&u.code.isOctalDigit(r.charCodeAt(i))&&(c=8*c+"01234567".indexOf(p()),"0123".indexOf(o)>=0&&n>i&&u.code.isOctalDigit(r.charCodeAt(i))&&(c=8*c+"01234567".indexOf(p()))),e+=String.fromCharCode(c)):e+=o}else{if(u.code.isLineTerminator(o.charCodeAt(0)))break;e+=o}}return""!==a&&l.throwError("unexpected quote"),s=e,t.STRING}function v(){var e,a;if(e="",a=r.charCodeAt(i),46!==a){if(e=p(),a=r.charCodeAt(i),"0"===e){if(120===a||88===a){for(e+=p();n>i&&(a=r.charCodeAt(i),u.code.isHexDigit(a));)e+=p();return e.length<=2&&l.throwError("unexpected token"),n>i&&(a=r.charCodeAt(i),u.code.isIdentifierStart(a)&&l.throwError("unexpected token")),s=parseInt(e,16),t.NUMBER}if(u.code.isOctalDigit(a)){for(e+=p();n>i&&(a=r.charCodeAt(i),u.code.isOctalDigit(a));)e+=p();return n>i&&(a=r.charCodeAt(i),(u.code.isIdentifierStart(a)||u.code.isDecimalDigit(a))&&l.throwError("unexpected token")),s=parseInt(e,8),t.NUMBER}u.code.isDecimalDigit(a)&&l.throwError("unexpected token")}for(;n>i&&(a=r.charCodeAt(i),u.code.isDecimalDigit(a));)e+=p()}if(46===a)for(e+=p();n>i&&(a=r.charCodeAt(i),u.code.isDecimalDigit(a));)e+=p();if(101===a||69===a)if(e+=p(),a=r.charCodeAt(i),(43===a||45===a)&&(e+=p()),a=r.charCodeAt(i),u.code.isDecimalDigit(a))for(e+=p();n>i&&(a=r.charCodeAt(i),u.code.isDecimalDigit(a));)e+=p();else l.throwError("unexpected token");return n>i&&(a=r.charCodeAt(i),u.code.isIdentifierStart(a)&&l.throwError("unexpected token")),s=parseFloat(e),t.NUMBER}function m(){var e,a;for(s=p();n>i&&c(r.charCodeAt(i));){if(e=r.charCodeAt(i),46===e){if(i+1>=n)return t.ILLEGAL;if(a=r.charCodeAt(i+1),60===a)break}s+=p()}return t.NAME}function g(){var e;for(a=i;n>i&&u.code.isWhiteSpace(r.charCodeAt(i));)p();if(i>=n)return o=t.EOF;switch(e=r.charCodeAt(i)){case 39:case 34:return o=d();case 58:return p(),o=t.COLON;case 44:return p(),o=t.COMMA;case 40:return p(),o=t.LPAREN;case 41:return p(),o=t.RPAREN;case 91:return p(),o=t.LBRACK;case 93:return p(),o=t.RBRACK;case 123:return p(),o=t.LBRACE;case 125:return p(),o=t.RBRACE;case 46:if(n>i+1){if(e=r.charCodeAt(i+1),60===e)return p(),p(),o=t.DOT_LT;if(46===e&&n>i+2&&46===r.charCodeAt(i+2))return p(),p(),p(),o=t.REST;if(u.code.isDecimalDigit(e))return o=v()}return o=t.ILLEGAL;case 60:return p(),o=t.LT;case 62:return p(),o=t.GT;case 42:return p(),o=t.STAR;case 124:return p(),o=t.PIPE;case 63:return p(),o=t.QUESTION;case 33:return p(),o=t.BANG;case 61:return p(),o=t.EQUAL;default:return u.code.isDecimalDigit(e)?o=v():(l.assert(c(e)),o=m())}}function y(e,t){l.assert(o===e,t||"consumed token not matched"),g()}function b(e,t){o!==e&&l.throwError(t||"unexpected token"),g()}function _(){var r;if(y(t.LPAREN,"UnionType should start with ("),r=[],o!==t.RPAREN)for(;;){if(r.push(q()),o===t.RPAREN)break;b(t.PIPE)}return y(t.RPAREN,"UnionType should end with )"),{type:e.UnionType,elements:r}}function w(){var r;for(y(t.LBRACK,"ArrayType should start with ["),r=[];o!==t.RBRACK;){if(o===t.REST){y(t.REST),r.push({type:e.RestType,expression:q()});break}r.push(q()),o!==t.RBRACK&&b(t.COMMA)}return b(t.RBRACK),{type:e.ArrayType,elements:r}}function x(){var e=s;return o===t.NAME||o===t.STRING?(g(),e):o===t.NUMBER?(y(t.NUMBER),String(e)):void l.throwError("unexpected token")}function E(){var r;return r=x(),o===t.COLON?(y(t.COLON),{type:e.FieldType,key:r,value:q()}):{type:e.FieldType,key:r,value:null}}function S(){var r;if(y(t.LBRACE,"RecordType should start with {"),r=[],o===t.COMMA)y(t.COMMA);else for(;o!==t.RBRACE;)r.push(E()),o!==t.RBRACE&&b(t.COMMA);return b(t.RBRACE),{type:e.RecordType,fields:r}}function k(){var r=s;return b(t.NAME),o!==t.COLON||"module"!==r&&"external"!==r&&"event"!==r||(y(t.COLON),r+=":"+s,b(t.NAME)),{type:e.NameExpression,name:r}}function C(){var e=[];for(e.push(B());o===t.COMMA;)y(t.COMMA),e.push(B());return e}function A(){var r,n;return r=k(),o===t.DOT_LT||o===t.LT?(g(),n=C(),b(t.GT),{type:e.TypeApplication,expression:r,applications:n}):r}function P(){return y(t.COLON,"ResultType should start with :"),o===t.NAME&&"void"===s?(y(t.NAME),{type:e.VoidLiteral}):q()}function T(){for(var i,r=[],n=!1,a=!1;o!==t.RPAREN;)o===t.REST&&(y(t.REST),a=!0),i=q(),i.type===e.NameExpression&&o===t.COLON&&(y(t.COLON),i={type:e.ParameterType,name:i.name,expression:q()}),o===t.EQUAL?(y(t.EQUAL),i={type:e.OptionalType,expression:i},n=!0):n&&l.throwError("unexpected token"),a&&(i={type:e.RestType,expression:i}),r.push(i),o!==t.RPAREN&&b(t.COMMA);return r}function O(){var r,n,i,a,u;return l.assert(o===t.NAME&&"function"===s,"FunctionType should start with 'function'"),y(t.NAME),b(t.LPAREN),r=!1,i=[],n=null,o!==t.RPAREN&&(o!==t.NAME||"this"!==s&&"new"!==s?i=T():(r="new"===s,y(t.NAME),b(t.COLON),n=A(),o===t.COMMA&&(y(t.COMMA),i=T()))),b(t.RPAREN),a=null,o===t.COLON&&(a=P()),u={type:e.FunctionType,params:i,result:a},n&&(u["this"]=n,r&&(u["new"]=!0)),u}function N(){var r;switch(o){case t.STAR:return y(t.STAR),{type:e.AllLiteral};case t.LPAREN:return _();case t.LBRACK:return w();case t.LBRACE:return S();case t.NAME:if("null"===s)return y(t.NAME),{type:e.NullLiteral};if("undefined"===s)return y(t.NAME),{type:e.UndefinedLiteral};if(r=f.save(),"function"===s)try{return O()}catch(n){r.restore()}return A();default:l.throwError("unexpected token")}}function q(){var r;return o===t.QUESTION?(y(t.QUESTION),o===t.COMMA||o===t.EQUAL||o===t.RBRACE||o===t.RPAREN||o===t.PIPE||o===t.EOF||o===t.RBRACK||o===t.GT?{type:e.NullableLiteral}:{type:e.NullableType,expression:N(),prefix:!0}):o===t.BANG?(y(t.BANG),{type:e.NonNullableType,expression:N(),prefix:!0}):(r=N(),o===t.BANG?(y(t.BANG),{type:e.NonNullableType,expression:r,prefix:!1}):o===t.QUESTION?(y(t.QUESTION),{type:e.NullableType,expression:r,prefix:!1}):o===t.LBRACK?(y(t.LBRACK),b(t.RBRACK,"expected an array-style type declaration ("+s+"[])"),{type:e.TypeApplication,expression:{type:e.NameExpression,name:"Array"},applications:[r]}):r)}function B(){var r,n;if(r=q(),o!==t.PIPE)return r;for(n=[r],y(t.PIPE);;){if(n.push(q()),o!==t.PIPE)break;y(t.PIPE)}return{type:e.UnionType,elements:n}}function R(){var r;return o===t.REST?(y(t.REST),{type:e.RestType,expression:B()}):(r=B(),o===t.EQUAL?(y(t.EQUAL),{type:e.OptionalType,expression:r}):r)}function I(e,s){var u;return r=e,n=r.length,i=0,a=0,g(),u=B(),s&&s.midstream?{expression:u,index:a}:(o!==t.EOF&&l.throwError("not reach to EOF"),u)}function M(e,s){var u;return r=e,n=r.length,i=0,a=0,g(),u=R(),s&&s.midstream?{expression:u,index:a}:(o!==t.EOF&&l.throwError("not reach to EOF"),u)}function D(t,r,n){var i,a,o;switch(t.type){case e.NullableLiteral:i="?";break;case e.AllLiteral:i="*";break;case e.NullLiteral:i="null";break;case e.UndefinedLiteral:i="undefined";break;case e.VoidLiteral:i="void";break;case e.UnionType:for(i=n?"":"(",a=0,o=t.elements.length;o>a;++a)i+=D(t.elements[a],r),a+1!==o&&(i+="|");n||(i+=")");break;case e.ArrayType:for(i="[",a=0,o=t.elements.length;o>a;++a)i+=D(t.elements[a],r),a+1!==o&&(i+=r?",":", ");i+="]";break;case e.RecordType:for(i="{",a=0,o=t.fields.length;o>a;++a)i+=D(t.fields[a],r),a+1!==o&&(i+=r?",":", ");i+="}";break;case e.FieldType:i=t.value?t.key+(r?":":": ")+D(t.value,r):t.key;break;case e.FunctionType:for(i=r?"function(":"function (",t["this"]&&(i+=t["new"]?r?"new:":"new: ":r?"this:":"this: ",i+=D(t["this"],r),0!==t.params.length&&(i+=r?",":", ")),a=0,o=t.params.length;o>a;++a)i+=D(t.params[a],r),a+1!==o&&(i+=r?",":", ");i+=")",t.result&&(i+=(r?":":": ")+D(t.result,r));break;case e.ParameterType:i=t.name+(r?":":": ")+D(t.expression,r);break;case e.RestType:i="...",t.expression&&(i+=D(t.expression,r));break;case e.NonNullableType:i=t.prefix?"!"+D(t.expression,r):D(t.expression,r)+"!";break;case e.OptionalType:i=D(t.expression,r)+"=";break;case e.NullableType:i=t.prefix?"?"+D(t.expression,r):D(t.expression,r)+"?";break;case e.NameExpression:i=t.name;break;case e.TypeApplication:for(i=D(t.expression,r)+".<",a=0,o=t.applications.length;o>a;++a)i+=D(t.applications[a],r),a+1!==o&&(i+=r?",":", ");i+=">";break;default:l.throwError("Unknown type "+t.type)}return i}function j(e,t){return null==t&&(t={}),D(e,t.compact,t.topLevel)}var e,t,r,n,i,a,o,s,u,l;u=require("esutils"),l=require("./utility"),e={NullableLiteral:"NullableLiteral",AllLiteral:"AllLiteral",NullLiteral:"NullLiteral",UndefinedLiteral:"UndefinedLiteral",VoidLiteral:"VoidLiteral",UnionType:"UnionType",ArrayType:"ArrayType",RecordType:"RecordType",FieldType:"FieldType",FunctionType:"FunctionType",ParameterType:"ParameterType",RestType:"RestType",NonNullableType:"NonNullableType",OptionalType:"OptionalType",NullableType:"NullableType",NameExpression:"NameExpression",TypeApplication:"TypeApplication"},t={ILLEGAL:0,DOT_LT:1,REST:2,LT:3,GT:4,LPAREN:5,RPAREN:6,LBRACE:7,RBRACE:8,LBRACK:9,RBRACK:10,COMMA:11,COLON:12,STAR:13,PIPE:14,QUESTION:15,BANG:16,EQUAL:17,NAME:18,STRING:19,NUMBER:20,EOF:21},f.prototype.restore=function(){a=this._previous,i=this._index,o=this._token,s=this._value},f.save=function(){return new f(a,i,o,s)},exports.parseType=I,exports.parseParamType=M,exports.stringify=j,exports.Syntax=e}();